<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Android 基本控件（二） | 平心de小屋</title><meta name="keywords" content="Android"><meta name="author" content="平心"><meta name="copyright" content="平心"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ListView 在Android开发中，ListView是比较常用的控件，它以列表的形式显示具体内容，并且能够根据数据的长度自适应显示。在学习ListView之前，先来一起了解AdapterView。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 基本控件（二）">
<meta property="og:url" content="https://pingxin0521.gitee.io/2019/04/29/Android-%E5%9F%BA%E7%A1%80-8/index.html">
<meta property="og:site_name" content="平心de小屋">
<meta property="og:description" content="ListView 在Android开发中，ListView是比较常用的控件，它以列表的形式显示具体内容，并且能够根据数据的长度自适应显示。在学习ListView之前，先来一起了解AdapterView。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg">
<meta property="article:published_time" content="2019-04-29T15:18:59.000Z">
<meta property="article:modified_time" content="2019-07-02T02:28:46.000Z">
<meta property="article:author" content="平心">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg"><link rel="shortcut icon" href="https://s2.ax1x.com/2020/02/11/1ovFOA.png"><link rel="canonical" href="https://pingxin0521.gitee.io/2019/04/29/Android-%E5%9F%BA%E7%A1%80-8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Android 基本控件（二）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2019-07-02 10:28:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://s2.ax1x.com/2020/02/11/1ovw6J.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">449</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">77</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">68</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">平心de小屋</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Android 基本控件（二）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-04-29T15:18:59.000Z" title="发表于 2019-04-29 23:18:59">2019-04-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2019-07-02T02:28:46.000Z" title="更新于 2019-07-02 10:28:46">2019-07-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/">Android</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/%E5%9F%BA%E7%A1%80/">基础</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>39分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Android 基本控件（二）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h3><p> 在Android开发中，ListView是比较常用的控件，它以列表的形式显示具体内容，并且能够根据数据的长度自适应显示。在学习ListView之前，先来一起了解AdapterView。</p>
<span id="more"></span>

<p>AdapterView是一组重要的组件，AdapterView本身是一个抽象基类，它派生的子类在用法上十分相似，只是显示界面有一定的区别，因此把它们归为一类，针对它们的共性集中讲解，并突出介绍它们的区别。AdapterView主要具有以下几个特征。</p>
<ul>
<li><p>AdapterView继承了 ViewGroup，它的本质是容器。</p>
</li>
<li><p>AdapterView可以包括多个“列表项”，并将多个“列表项”以合适的形式显示出来。</p>
</li>
<li><p>AdapterView显示的多个“列表项”由Adapter提供。调用AdapterView的 setAdapter(Adapter)方法设置 Adapter 即可。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2019/05/08/5cd2951e2adfc.jpeg" alt="3.jpeg"></p>
<p>从上图可以看出，AdapterView派生了三个子类：AbsListView、AbsSpinner 和 AdapterViewAnimator，这三个子类依然是抽象的，实际使用时往往采用它们的子类。</p>
<p>先从比较简单的子类ListView的使用方法开始学习，使用ListView主要有以下两种方式。</p>
<ul>
<li>直接使用ListView进行创建。</li>
<li>让 Activity 继承 ListActivity （相当于该 Activity 显示的组件为 ListView，后续再进行学习）。</li>
</ul>
<p> 一旦在程序中获得了 ListView之后，接下来就需要为ListView设置它要显示的列表项了。<br>在这一点上，ListView显示出AdapterView的特征：通过setAdapter(Adapter)方法为之提供<br>Adapter，并由Adapter提供列表项即可。</p>
<p>ListView提供的常用XML属性如下所示：</p>
<ul>
<li><p>android:divider：设置 List 列表项的分隔条（即可用颜色分隔，也可用 Drawable 分隔）。</p>
</li>
<li><p>android:dividerHeight：设置分隔条的高度。</p>
</li>
<li><p>android:entries：指定一个数组资源，Android 将根据该数组资源来生成 ListView。</p>
</li>
<li><p>android:footerDividerEnabled：如果设置为 false，则不在 footer View 之前绘制分隔条。</p>
</li>
<li><p>android:footerDividerEnabled：如果设置为 false，则不在 header View 之后绘制分隔条。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//xml文件</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">              android:orientation=&quot;vertical&quot;</span><br><span class="line">              android:layout_width=&quot;match_parent&quot;</span><br><span class="line">              android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 直接使用数组资源给出列表项 --&gt;</span><br><span class="line">    &lt;!-- 设置使用蓝色的分隔条 --&gt;</span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:entries=&quot;@array/countries&quot;</span><br><span class="line">        android:divider=&quot;#00f&quot;</span><br><span class="line">        android:dividerHeight=&quot;2px&quot;</span><br><span class="line">        android:headerDividersEnabled=&quot;false&quot;/&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br><span class="line">//arrays.xml文件</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;string-array name=&quot;counties&quot;&gt;</span><br><span class="line">        &lt;item&gt;中华人民共和国&lt;/item&gt;</span><br><span class="line">        &lt;item&gt;美利坚合众国&lt;/item&gt;</span><br><span class="line">        &lt;item&gt;俄罗斯联邦&lt;/item&gt;</span><br><span class="line">        &lt;item&gt;比利时王国&lt;/item&gt;</span><br><span class="line">        &lt;item&gt;德意志共和国&lt;/item&gt;</span><br><span class="line">    &lt;/string-array&gt;</span><br><span class="line">&lt;/resources&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 从上述示例程序发现，使用数组创建ListView非常简单，但这种ListView 能定制的内容很少，甚至连每个列表项的字号大小、颜色都不能改变。 如果想对ListView的外观、行为进行定制，就需要把ListView作为AdapterView使用，通过Adapter控制每个列表项的外观和行为。</p>
<h3 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h3><h4 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h4><p> 在Android开发中，比较流行的开发框架模式采用的是MVC框架模式，采用MVC模式的好处是便于UI界面部分的显示和业务逻辑，数据处理分开。那么Android项目中哪些代码来充当M、V、C角色呢？</p>
<p>Android 鼓励弱耦合和组件的重用，Android 中MVC的具体体现如下：</p>
<ul>
<li><p>模型（model）：是应用程序的主题部分，所有的业务逻辑都应在该层（对数据库的操作、对网络等的操作都应该在model里面处理，当然对计算等操作也是必须放在该层的）。</p>
</li>
<li><p>视图层（view）：是应用程序中负责生成用户界面的部分。也是整个MVC架构中用户唯一可以看到的一层，接收用户的输入，显示用户的处理结果。一般用XML文件进行界面的描述，使用的时候可以非常方便的引入。</p>
</li>
<li><p>控制层（controller）：是根据用户的输入，控制用户界面数据显示及更新model对象状态的部分。Android的控制层的重任通常落在了众多Activity的肩上，这句话也就暗含了不要在Activity中写过多代码，要通过Activity交给model业务逻辑处理层处理，这样做的另外一个原因是Android中的Activity的响应时间是5秒，如果耗时的操作放在这里，程序很容易无响应。</p>
</li>
</ul>
<p>在MVC模式中其实控制器Activity主要是起到解耦作用，将View视图和Model模型分离，虽然Activity起到交互作用，但是一般在Activity中有很多关于视图UI的显示代码，因此View视图和Activity控制器并不是完全分离的，也就是说一部分View视图和Contronller控制器Activity是绑定在一个类中的。</p>
<p>使用MVC模式的优点：</p>
<ul>
<li><p>耦合性低。所谓耦合性就是模块代码之间的关联程度。利用MVC框架使得View（视图）层和Model（模型）层可以很好的分离，这样就达到了解耦的目的，所以耦合性低，减少模块代码之间的相互影响。</p>
</li>
<li><p>可扩展性好。由于耦合性低，添加需求，扩展代码就可以减少修改之前的代码，降低bug的出现率。</p>
</li>
<li><p>模块职责划分明确。主要划分层M、V、C三个模块，利于代码的维护。</p>
</li>
</ul>
<p>什么时候适合使用MVC设计模式？当然一个小的项目且无需频繁修改需求就不用MVC框架来设计了，那样反而觉得代码过度设计，代码臃肿。一般在大型项目中，且业务逻辑处理复杂，页面显示比较多，需要模块化设计的项目使用MVC就有足够的优势了。</p>
<h4 id="Adapter-1"><a href="#Adapter-1" class="headerlink" title="Adapter"></a>Adapter</h4><p>Adapter是连接后端数据和前端显示的适配器接口，是数据和UI（View）之间一个重要的纽带。在常见的View（ListView、GridView）等地方都需要用到Adapter。</p>
<p>Android的适配器负责为列表组件提供数据源，也负责将单独的数据元素转换为显示在列表组件中的特定视图，如ListView的适配器关系如下图所示。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2019/07/02/5d1ac118c6a2f88649.jpg"></p>
<p>Adapter本身只是一个接口，它派生了 ListAdapter和SpinnerAdapter两个子接口，其中 ListAdapter 为 AbsListView 提供列表项，而 SpinnerAdapter 为 AbsSpinner 提供列表项。Adapter接口及其实现类的继承关系图如下图所示。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2019/05/08/5cd297c185fb4.jpeg" alt="5.jpeg"></p>
<p>上图中标红粗线框标出的是比较常用的Adapter。从图中可以看出几乎所有的Adapter都继承了 BaseAdapter，而BaseAdapter同时实现了 ListAdapter、SpinnerAdapter 两个接口，因此 BaseAdapter 及其子类可以同时为 AbsListView、AbsSpinner提供列表项。</p>
<p>Adapter的几个常用实现类如下。</p>
<ul>
<li><p>ArrayAdapter：简单、易用的Adapter，通常用于将数组或List集合的多个值包装成多个列表项。</p>
</li>
<li><p>SimpleAdapter：并不简单、功能强大的Adapter，可用于将List集合的多个对象包装成多个列表项。</p>
</li>
<li><p>SimpleCursorAdapter：与SimpleAdapter基本相似，只是用于包装Cursor提供的数据。</p>
</li>
<li><p>BaseAdapter：通常用于被扩展，扩展BaseAdapter可以对各列表项进行最大限度的定制。</p>
</li>
</ul>
<p>xml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">              android:orientation=&quot;vertical&quot;</span><br><span class="line">              android:layout_width=&quot;match_parent&quot;</span><br><span class="line">              android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 设置使用绿色的分隔条 --&gt;</span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:id=&quot;@+id/listview&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:divider=&quot;#0f0&quot;</span><br><span class="line">        android:dividerHeight=&quot;2px&quot;</span><br><span class="line">        android:headerDividersEnabled=&quot;false&quot;/&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>java文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import android.os.Bundle;</span><br><span class="line">import android.support.v7.app.AppCompatActivity;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.widget.AdapterView;</span><br><span class="line">import android.widget.ArrayAdapter;</span><br><span class="line">import android.widget.ListView;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line"> </span><br><span class="line">public class ArrayAdapterActivity extends AppCompatActivity &#123;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.arrayadapter_layout);</span><br><span class="line"> </span><br><span class="line">        // 获取界面ListView组件</span><br><span class="line">        ListView listView = (ListView) findViewById(R.id.listview);</span><br><span class="line"> </span><br><span class="line">        // 定义一个数组</span><br><span class="line">        final String[] books = &#123;&quot;初识Android开发&quot;, &quot;Android初级开发&quot;, &quot;Android中级开发&quot;,</span><br><span class="line">                &quot;Android高级开发&quot;, &quot;Android开发进阶&quot;, &quot;Android项目实战&quot;, &quot;Android企业级开发&quot;&#125;;</span><br><span class="line">        // 将数组包装成ArrayAdapter</span><br><span class="line">        ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,</span><br><span class="line">                android.R.layout.simple_list_item_1, books);</span><br><span class="line"> </span><br><span class="line">        // 为ListView设置Adapter</span><br><span class="line">        listView.setAdapter(adapter);</span><br><span class="line"> </span><br><span class="line">        // 为ListView绑定列表项点击事件监听器</span><br><span class="line">        listView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int position, long id) &#123;</span><br><span class="line">                Toast.makeText(ArrayAdapterActivity.this, &quot;点击了&quot; + books[position],</span><br><span class="line">                        Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 上面的程序中前面两行粗体代码创建了一个ArrayAdapter，创建ArrayAdapter时必须指定如下三个参数。</p>
<ul>
<li><p>context：要使用的上下文环境，几乎创建所有组件都需要传入Context对象。</p>
</li>
<li><p>resource： 要使用的视图资源 ID，该视图将作为ArrayAdapter的列表项组件。这里使用了Android系统中自带的视图资源，系统预定义的视图资源主要有以下几种：</p>
<ul>
<li>​    android.R.layout.simple_list_item_1: 单独一行的文本框。</li>
<li>​    android.R.layout.simple_list_item_2: 两个文本框组成。</li>
<li>​    android.R.layout.simple_list_item_checked: 每项都是由一个已选中的列表项。</li>
<li>​    android.R.layout.simple_list_item_multiple_choice: 都带有一个复选框。</li>
<li>​    android.R.layout.simple_list_item_single_choice: 都带有一个单选钮。</li>
</ul>
</li>
<li><p>objects：要实际显示的数组或List，将负责为多个列表项提供数据。 该数组或List包含多少个元素，就将生成多少个列表项。</p>
</li>
</ul>
<p>上面的程序中后面几行粗体代码为ListView列表项添加点击事件监听器，当用户点击某列表项的时候，就会收到onItemClick事件，然后做消息提示或者其他需要的处理。</p>
<h3 id="ListActivity"><a href="#ListActivity" class="headerlink" title="ListActivity"></a>ListActivity</h3><p>如果程序的窗口仅仅需要显示一个列表，则可以直接让Activity继承ListActivity来实现， ListActivity的子类无须调用setContentView()方法来显示某个界面，而是可以直接传入一个内容Adapter，ListActivity的子类就呈现出一个列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> import android.app.ListActivity;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.widget.ArrayAdapter;</span><br><span class="line"> </span><br><span class="line">public class MyListActivity extends ListActivity &#123;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line"> </span><br><span class="line">        // 定义一个数组</span><br><span class="line">        String[] persons = &#123;&quot;蜡笔小新&quot;, &quot;皮卡丘&quot;, &quot;蜘蛛侠&quot;, &quot;灰太狼&quot;, &quot;黑猫警长&quot;,</span><br><span class="line">                &quot;孙悟空&quot;, &quot;忍者神龟&quot;, &quot;米老鼠&quot;, &quot;HelloKitty&quot;, &quot;樱桃小丸子&quot;&#125;;</span><br><span class="line"> </span><br><span class="line">        // 将数组包装成ArrayAdapter</span><br><span class="line">        ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,</span><br><span class="line">                android.R.layout.simple_list_item_single_choice, persons);</span><br><span class="line"> </span><br><span class="line">        // 设置该窗口显示列表</span><br><span class="line">        setListAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义列表项"><a href="#自定义列表项" class="headerlink" title="自定义列表项"></a>自定义列表项</h3><p>前面学习ListView都是使用的Android系统自定义列表项资源，基本都是一些纯文本的资源，界面不够炫目，也没有办法定制。在实际开发中，列表经常包括图标、按钮等组件，这就需要开发者自定义列表项来完成了。关键是需要给适配器Adapter提供足够的数据，让Adapter能够用更丰富的View对象来填充列表的每一行。</p>
<p>custom_item_layout.xml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">              android:orientation=&quot;vertical&quot;</span><br><span class="line">              android:layout_width=&quot;match_parent&quot;</span><br><span class="line">              android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:id=&quot;@+id/listview&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>custom_item.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">              android:layout_width=&quot;match_parent&quot;</span><br><span class="line">              android:layout_height=&quot;match_parent&quot;</span><br><span class="line">              android:orientation=&quot;horizontal&quot;</span><br><span class="line">              android:gravity=&quot;center_vertical&quot;&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=&quot;@+id/icon_img&quot;</span><br><span class="line">        android:layout_width=&quot;50dp&quot;</span><br><span class="line">        android:layout_height=&quot;50dp&quot;</span><br><span class="line">        android:padding=&quot;5dp&quot;</span><br><span class="line">        android:src=&quot;@mipmap/ic_launcher&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/content_tv&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textSize=&quot;24sp&quot;</span><br><span class="line">        android:textColor=&quot;#00f&quot;/&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>这个布局使用LinearLayout作为一行，其中图标位于左侧，文本位于右侧。接下来为ListView提供Adapter，Adapter决定了ListView所要显示的列表项。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import android.os.Bundle;</span><br><span class="line">import android.support.v7.app.AppCompatActivity;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.widget.AdapterView;</span><br><span class="line">import android.widget.ArrayAdapter;</span><br><span class="line">import android.widget.ListView;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line"> </span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"> </span><br><span class="line">public class CustomItemActivity extends AppCompatActivity &#123;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.custom_item_layout);</span><br><span class="line"> </span><br><span class="line">        // 获取界面ListView组件</span><br><span class="line">        ListView listView = (ListView) findViewById(R.id.listview);</span><br><span class="line"> </span><br><span class="line">        // 定义一个List集合</span><br><span class="line">        final List&lt;String&gt; components = new ArrayList&lt;&gt;();</span><br><span class="line">        components.add(&quot;TextView&quot;);</span><br><span class="line">        components.add(&quot;EditText&quot;);</span><br><span class="line">        components.add(&quot;Button&quot;);</span><br><span class="line">        components.add(&quot;CheckBox&quot;);</span><br><span class="line">        components.add(&quot;RadioButton&quot;);</span><br><span class="line">        components.add(&quot;ToggleButton&quot;);</span><br><span class="line">        components.add(&quot;ImageView&quot;);</span><br><span class="line"> </span><br><span class="line">        // 将List包装成ArrayAdapter</span><br><span class="line">        ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,</span><br><span class="line">                R.layout.custom_item, R.id.content_tv, components);</span><br><span class="line"> </span><br><span class="line">        // 为ListView设置Adapter</span><br><span class="line">        listView.setAdapter(adapter);</span><br><span class="line"> </span><br><span class="line">        // 为ListView列表项绑定点击事件监听器</span><br><span class="line">        listView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int position, long id) &#123;</span><br><span class="line">                Toast.makeText(CustomItemActivity.this, components.get(position),</span><br><span class="line">                        Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用了自定义列表布局R.layout.list_item。创建ArrayAdapter必须指定如下四个参数。</p>
<ul>
<li><p>context：要使用的上下文环境，几乎创建所有组件都需要传入Context对象。</p>
</li>
<li><p>resource： 要使用的自定义列表项布局资源 ID。</p>
</li>
<li><p>textViewResourceId：自定义列表布局中TextView的ID，该TextView组件将作为ArrayAdapter的列表项组件。</p>
</li>
<li><p>objects：要实际显示的数组或List，将负责为多个列表项提供数据。 该数组或List包含多少个元素，就将生成多少个列表项。</p>
</li>
</ul>
<p> 但是在这个示例中，所有的图标都是相同的，往往不能满足实际开发需求</p>
<h3 id="自定义ArrayAdapter"><a href="#自定义ArrayAdapter" class="headerlink" title="自定义ArrayAdapter"></a>自定义ArrayAdapter</h3><p>如果需要每个列表项的图标根据内容动态表示，Android系统的ArrayAdapter就无能为力了，就只能使用自定义ArrayAdapter来实现啦。</p>
<p>做法就是创建一个ArrayAdapter的子类，重写其getView()方法，再构建不同的列表项。其中getView()方法返回的是一个View，也就是与Adapter数据对应的相应位置的行。</p>
<p>在学习自定义ArrayAdapter前，一起先来学习一下LayoutInflater类。在实际开发中LayoutInflater这个类还是非常有用的，它的作用类似于findViewById()。不同点是LayoutInflater是用来找res/layout/下的xml布局文件并实例化；而findViewById()是找xml布局文件下的具体widget控件（如Button、TextView等）。</p>
<p>LayoutInflater 是一个抽象类，获得 LayoutInflater 实例有以下三种方式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 通过Activity获取</span><br><span class="line">LayoutInflaterinflater=getLayoutInflater();</span><br><span class="line"> </span><br><span class="line">// 通过静态方法获取</span><br><span class="line">LayoutInflaterinflater=LayoutInflater.from(context);</span><br><span class="line"> </span><br><span class="line">// 通过系统服务获取</span><br><span class="line">LayoutInflaterinflater= (LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br></pre></td></tr></table></figure>

<p>其实这三种方式最终本质是都是调用的Context.getSystemService()，关于该方法的使用会在后续内容进行学习。</p>
<p>获得LayoutInflater 实例后，就可以调用inflater.inflater()方法来查找并实例化布局文件了，常用于获得ListView的每个Item布局</p>
<p>在上面示例的基础下更改：</p>
<p>新建MyArrayAdapter类，继承ArrayAdapter类，重写getView()方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">import android.app.Activity;</span><br><span class="line">import android.support.annotation.NonNull;</span><br><span class="line">import android.view.LayoutInflater;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line">import android.widget.ArrayAdapter;</span><br><span class="line">import android.widget.ImageView;</span><br><span class="line">import android.widget.TextView;</span><br><span class="line"></span><br><span class="line">public class MyArrayAdapter extends ArrayAdapter &#123;</span><br><span class="line">    private Activity mContext = null; // 上下文环境</span><br><span class="line">    private int mResourceId; // 列表项布局资源ID</span><br><span class="line">    private String[] mItems; // 列表内容数组</span><br><span class="line"> </span><br><span class="line">    public MyArrayAdapter(Activity context, int resId, String[] items)&#123;</span><br><span class="line">        super(context, resId, items);</span><br><span class="line">        // 保存参数</span><br><span class="line">        mContext = context;</span><br><span class="line">        mResourceId = resId;</span><br><span class="line">        mItems = items;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @NonNull</span><br><span class="line">    @Override</span><br><span class="line">    public View getView(int position, View convertView, ViewGroup parent) &#123;</span><br><span class="line">        // 获取LayoutInflater对象</span><br><span class="line">        LayoutInflater inflater = mContext.getLayoutInflater();</span><br><span class="line">        // 装载列表项视图</span><br><span class="line">        View itemView = inflater.inflate(mResourceId, null);</span><br><span class="line"> </span><br><span class="line">        // 获取列表项之组件</span><br><span class="line">        TextView contentTv = (TextView) itemView.findViewById(R.id.content_tv);</span><br><span class="line">        ImageView letterImg = (ImageView) itemView.findViewById(R.id.icon_img);</span><br><span class="line"> </span><br><span class="line">        // 取出要显示的数据</span><br><span class="line">        String content = mItems[position].trim();</span><br><span class="line"> </span><br><span class="line">        // 给TextView设置显示值</span><br><span class="line">        contentTv.setText(content);</span><br><span class="line">        // 根据内容首字母判断要显示的图标</span><br><span class="line">        if(content.startsWith(&quot;a&quot;) || content.startsWith(&quot;A&quot;)) &#123;</span><br><span class="line">            letterImg.setImageResource(R.drawable.letter_a);</span><br><span class="line">        &#125; else if(content.startsWith(&quot;b&quot;) || content.startsWith(&quot;B&quot;)) &#123;</span><br><span class="line">            letterImg.setImageResource(R.drawable.letter_b);</span><br><span class="line">        &#125; else if(content.startsWith(&quot;c&quot;) || content.startsWith(&quot;C&quot;)) &#123;</span><br><span class="line">            letterImg.setImageResource(R.drawable.letter_c);</span><br><span class="line">        &#125; else if(content.startsWith(&quot;d&quot;) || content.startsWith(&quot;D&quot;)) &#123;</span><br><span class="line">            letterImg.setImageResource(R.drawable.letter_d);</span><br><span class="line">        &#125; else if(content.startsWith(&quot;e&quot;) || content.startsWith(&quot;E&quot;)) &#123;</span><br><span class="line">            letterImg.setImageResource(R.drawable.letter_e);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        // 返回列表项视图</span><br><span class="line">        return itemView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 在上述代码中，重写了getView()方法，以便根据要显示的对象返回列表项，其中对象是用Adapter中的位置索引来表示的。</p>
<p>通过LayoutInflater获取到的View对象，实际上就有由列表项布局文件，包含ImageView和TextView的LinearLayout。然后找到ImageView和TextView组件，填充内容给TextView，并根据内容的首字母来判断ImageView要显示的字母图标。</p>
<p>将上面的Activity类更改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,R.layout.custom_item, R.id.content_tv, components);</span><br><span class="line">改为</span><br><span class="line">// 将数组包装为自定义MyArrayAdapter</span><br><span class="line">MyArrayAdapter adapter = new MyArrayAdapter(this,R.layout.custom_item, R.id.content_tv, components);</span><br></pre></td></tr></table></figure>

<h3 id="SimpleAdapter"><a href="#SimpleAdapter" class="headerlink" title="SimpleAdapter"></a>SimpleAdapter</h3><p>通过ArrayAdapter实现Adapter虽然简单、易用，但ArrayAdapter的功能比较有限，它的每个列表项只能给一个TextView动态填充内容。如果开发者需要实现更复杂的列表项，则可以考虑使用 SimpleAdapter。</p>
<p>在使用SimpleAdapter之前，先来一起学习SimpleAdapter的构造方法，其构造方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleAdapter(Contextcontext,List&lt;?extendsMap&lt;String,?&gt;&gt;data,intresource,String[]from,int[]to)</span><br></pre></td></tr></table></figure>

<p>从SimpleAdapter的构造方法可以看到，一共需要5个参数，这也是很多开发者觉得使用SimpleAdapter比较难的原因，其实就是没有很好的理解这5个参数。这个5个参数的含义如下：</p>
<ul>
<li><p>context：要使用的上下文环境。</p>
</li>
<li><p>data：是一个<code>List&lt;? extends Map&lt;String, ?&gt;&gt;</code>类型的集合对象，该集合中每个Map&lt;String, ?&gt;对象生成一个列表项。</p>
</li>
<li><p>resource：界面布局文件的ID，对应的布局文件作为列表项的组件。</p>
</li>
<li><p>from：是一个String[]类型的参数，该参数决定提取Map&lt;String, ?&gt;对象中哪些key对应的value来生成列表项。</p>
</li>
<li><p>to：该参数是一个int[]类型的参数，该参数决定填充哪些组件</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"> // 获取界面组件</span><br><span class="line"> ListView listView = (ListView) findViewById(R.id.listview);</span><br><span class="line"></span><br><span class="line">// 创建一个SimpleAdapter</span><br><span class="line">SimpleAdapter adapter = new SimpleAdapter(this,</span><br><span class="line">getData(),</span><br><span class="line">R.layout.simpleadapter_item,</span><br><span class="line">new String[]&#123;&quot;img&quot;, &quot;title&quot;, &quot;info&quot;&#125;,</span><br><span class="line">new int[]&#123;R.id.icon_img, R.id.title_tv, R.id.info_tv&#125;);</span><br><span class="line"></span><br><span class="line">// 为ListView设置Adapter</span><br><span class="line">listView.setAdapter(adapter);</span><br><span class="line"></span><br><span class="line">//getData函数</span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line"> *  创建一个List集合，其元素为Map</span><br><span class="line"> * @return 返回列表项的集合对象</span><br><span class="line"> */</span><br><span class="line"> private List&lt;Map&lt;String, Object&gt;&gt; getData() &#123;</span><br><span class="line"> List&lt;Map&lt;String, Object&gt;&gt; list = new ArrayList&lt;Map&lt;String, Object&gt;&gt;();</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">map.put(&quot;img&quot;, R.drawable.item_01);</span><br><span class="line">map.put(&quot;title&quot;, &quot;小宗&quot;);</span><br><span class="line">map.put(&quot;info&quot;, &quot;电台DJ&quot;);</span><br><span class="line">list.add(map);</span><br><span class="line"></span><br><span class="line">map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">map.put(&quot;img&quot;, R.drawable.item_02);</span><br><span class="line">map.put(&quot;title&quot;, &quot;貂蝉&quot;);</span><br><span class="line">map.put(&quot;info&quot;, &quot;四大美女&quot;);</span><br><span class="line">list.add(map);</span><br><span class="line"></span><br><span class="line">map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">map.put(&quot;img&quot;, R.drawable.item_03);</span><br><span class="line">map.put(&quot;title&quot;, &quot;奶茶&quot;);</span><br><span class="line">map.put(&quot;info&quot;, &quot;清纯妹妹&quot;);</span><br><span class="line">list.add(map);</span><br><span class="line"></span><br><span class="line">map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">map.put(&quot;img&quot;, R.drawable.item_04);</span><br><span class="line">map.put(&quot;title&quot;, &quot;大黄&quot;);</span><br><span class="line">map.put(&quot;info&quot;, &quot;是小狗&quot;);</span><br><span class="line">list.add(map);</span><br><span class="line"></span><br><span class="line">map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">map.put(&quot;img&quot;, R.drawable.item_05);</span><br><span class="line">map.put(&quot;title&quot;, &quot;hello&quot;);</span><br><span class="line">map.put(&quot;info&quot;, &quot;every thing&quot;);</span><br><span class="line">list.add(map);</span><br><span class="line"></span><br><span class="line">map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">map.put(&quot;img&quot;, R.drawable.item_06);</span><br><span class="line">map.put(&quot;title&quot;, &quot;world&quot;);</span><br><span class="line">map.put(&quot;info&quot;, &quot;hello world&quot;);</span><br><span class="line">list.add(map);</span><br><span class="line"></span><br><span class="line">return list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//simpleadapter_item.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">              android:layout_width=&quot;match_parent&quot;</span><br><span class="line">              android:layout_height=&quot;match_parent&quot;</span><br><span class="line">              android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=&quot;@+id/icon_img&quot;</span><br><span class="line">        android:layout_width=&quot;50dp&quot;</span><br><span class="line">        android:layout_height=&quot;50dp&quot;</span><br><span class="line">        android:padding=&quot;5dp&quot; /&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/title_tv&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:textSize=&quot;16sp&quot; /&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/info_tv&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:textSize=&quot;10sp&quot; /&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>



<p>SimpleAdapter 同样可作为 ListActivity 的内容Adapter，这样可以让用户方便地定制ListActivity所显示的列表项。</p>
<p>同ArrayAdapter创建ListView一样，如果需要监听用户单击、选中某个列表项的事件，则可以通过AdapterView的setOnltemClickListener()方法为单击事件添加监听器，或者通过 setOnItemSelectedListener()方法为列表项的选中事件添加监听器。</p>
<h3 id="自定义BaseAdapter"><a href="#自定义BaseAdapter" class="headerlink" title="自定义BaseAdapter"></a>自定义BaseAdapter</h3><p>在ListView的使用中，有时候还需要在里面加入按钮等控件，实现单独的操作。也就是说，这个ListView不再只是展示数据，也不仅仅是这一行要来处理用户的操作，而是里面的控件要获得用户的焦点。读者可以试试用SimpleAdapter添加一个按钮到ListView的条目中，会发现可以添加，但是却无法获得焦点，点击操作被ListView的Item所覆盖。这时候最方便的方法就是使用灵活的适配器BaseAdapter了。</p>
<p>BaseAdapter是Android应用程序中经常用到的基础数据适配器的基类，它实现了Adapter接口。其主要用途是将一组数据传到像ListView、Spinner、Gallery及GridView等UI显示组件进行显示。</p>
<p>由于BaseAdapter是一个抽象类，所以使用BaseAdapter时必须有一个类继承它，并实现它的方法。BaseAdapter的灵活性就在其要重写的很多方法，常会重写的几个方法如下。</p>
<ul>
<li><p>int getCount()：主要是获得列表项的数量。</p>
</li>
<li><p>Object getItem(int position)：主要是获得当前列表项。</p>
</li>
<li><p>long getItemId(int position)：主要是获得当前列表项的ID。</p>
</li>
<li><p>View getView(int position, View convertView, ViewGroup parent)：主要是获得第position处的列表项组件。</p>
</li>
</ul>
<p>在上面示例的基础上，创建Data类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">class Data &#123;</span><br><span class="line">    private int icon; // 图标数据</span><br><span class="line">    private String title; // 标题数据</span><br><span class="line">    private String info; // 信息描述数据</span><br><span class="line"> </span><br><span class="line">    // 构造方法</span><br><span class="line">    public Data() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    public Data(int icon, String title, String info) &#123;</span><br><span class="line">        this.icon = icon;</span><br><span class="line">        this.title = title;</span><br><span class="line">        this.info = info;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    // Getter和Setter方法</span><br><span class="line">    public int getIcon() &#123;</span><br><span class="line">        return icon;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setIcon(int icon) &#123;</span><br><span class="line">        this.icon = icon;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getTitle() &#123;</span><br><span class="line">        return title;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setTitle(String title) &#123;</span><br><span class="line">        this.title = title;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getInfo() &#123;</span><br><span class="line">        return info;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setInfo(String info) &#123;</span><br><span class="line">        this.info = info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建MyBaseAdapter类，继承BaseAdapter类，重写其4个主要方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.BaseAdapter;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBaseAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context mContext; <span class="comment">// 上下文环境</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Data&gt; mDatas; <span class="comment">// 列表数据集合</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mResId; <span class="comment">// 列表项布局文件ID</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBaseAdapter</span><span class="params">(Context context, List&lt;Data&gt; datas, <span class="keyword">int</span> resId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mContext = context;</span><br><span class="line">        <span class="keyword">this</span>.mDatas = datas;</span><br><span class="line">        <span class="keyword">this</span>.mResId = resId;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 获得列表项的数量</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mDatas.size();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 获得当前列表项</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Data <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mDatas.get(position);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 获得当前列表项的ID</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 获得第position处的列表项组件</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup viewGroup)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取LayoutInflater对象</span></span><br><span class="line">        LayoutInflater inflater = LayoutInflater.from(mContext);</span><br><span class="line">        <span class="comment">// 装载列表项视图</span></span><br><span class="line">        View itemView = inflater.inflate(mResId, <span class="keyword">null</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 获取列表项组件</span></span><br><span class="line">        ImageView iconImg = (ImageView) itemView.findViewById(R.id.icon_img);</span><br><span class="line">        TextView titleTv = (TextView) itemView.findViewById(R.id.title_tv);</span><br><span class="line">        TextView infoTv = (TextView) itemView.findViewById(R.id.info_tv);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 给列表项赋值</span></span><br><span class="line">        Data data = getItem(position);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != data) &#123;</span><br><span class="line">            iconImg.setImageResource(data.getIcon());</span><br><span class="line">            titleTv.setText(data.getTitle());</span><br><span class="line">            infoTv.setText(data.getInfo());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> itemView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更改Activity中的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取界面组件</span></span><br><span class="line">ListView listView = (ListView) findViewById(R.id.listview);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将数组包装为自定义MyBaseAdapter</span></span><br><span class="line">MyBaseAdapter adapter = <span class="keyword">new</span> MyBaseAdapter(<span class="keyword">this</span>, getData(), R.layout.custom_baseadapter_item);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为ListView设置Adapter</span></span><br><span class="line">listView.setAdapter(adapter);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取列表数据</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Data&gt; <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">List&lt;Data&gt; datas = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">datas.add(<span class="keyword">new</span> Data(R.drawable.item_01, <span class="string">&quot;小宗&quot;</span>, <span class="string">&quot;电台DJ&quot;</span>));</span><br><span class="line">datas.add(<span class="keyword">new</span> Data(R.drawable.item_02, <span class="string">&quot;貂蝉&quot;</span>, <span class="string">&quot;四大美女&quot;</span>));</span><br><span class="line">datas.add(<span class="keyword">new</span> Data(R.drawable.item_03, <span class="string">&quot;奶茶&quot;</span>, <span class="string">&quot;清纯妹妹&quot;</span>));</span><br><span class="line">datas.add(<span class="keyword">new</span> Data(R.drawable.item_04, <span class="string">&quot;大黄&quot;</span>, <span class="string">&quot;是小狗&quot;</span>));</span><br><span class="line">datas.add(<span class="keyword">new</span> Data(R.drawable.item_05, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;every thing&quot;</span>));</span><br><span class="line">datas.add(<span class="keyword">new</span> Data(R.drawable.item_06, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;hello world&quot;</span>));</span><br><span class="line"><span class="keyword">return</span> datas;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以发现使用自定义BaseAdapter创建ListView，界面交互代码非常简洁，却可以实现非常复杂的界面。</p>
<h3 id="ListView优化和列表首尾使用"><a href="#ListView优化和列表首尾使用" class="headerlink" title="ListView优化和列表首尾使用"></a>ListView优化和列表首尾使用</h3><h4 id="使用convertView"><a href="#使用convertView" class="headerlink" title="使用convertView"></a>使用convertView</h4><p>前面讲的自定义ArrayAdapter和自定义BaseAdapter，都会重写getView()方法，虽然可以正常使用，但其实效率非常低。当列表项很多时，用户每次滚动屏幕，都会创建一批新的View对象，以填充新出现的列表项，这样势必会影响用户体验。</p>
<p>我们可以看到getView()方法中传入了一个参数convertView，可以验证该convertView的值有时候是null，有时候又不是null，特别是当用户滚动ListView的时候。其实这是适配器使用相同组件动态绑定数据的方式进行了优化，这是为何呢？</p>
<p>大家可以想想，如果列表项有成百上千个，Android系统会为每个列表项新建一个列表项组件吗？当然这是不可能的，毕竟Android系统的内存有限，不可能无限新建列表项组件。实际上Android缓存了视图组件，由于Android系统中有一个Recycler构件，其工作原理如下图所示。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2019/05/08/5cd2a15261cd8.jpeg" alt="6.jpeg"></p>
<p>如果有很多个列表项，其中只有可见的列表项组件保存在内存中，其他的都在Recycler中。其实Recyler可以理解为就是一个队列，用来存储不在屏幕范围内的item，如果item完全滚粗屏幕范围，那么该item就保存在队列中；如果新的item要滚动出来，那么就会首先查看Recyler是否含有可以重复使用的View，如果有就直接重新设置该View 的数据源，然后显示出来。</p>
<p>其实Recycler缓存的item就是getView()方法中的参数convertView。所以会发现convertView有时候为null，有时候不为null。那么我们是否可以利用这一点来优化我们的ListView运行效率呢？答案是肯定的。</p>
<p>接下来就在“自定义BaseAdapter”的基础上来开始优化，除了MyBaseAdapter类的getView()方法代码会发生改变，其他不变。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得第position处的列表项组件</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup viewGroup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == convertView) &#123;</span><br><span class="line">            <span class="comment">// 获取LayoutInflater对象</span></span><br><span class="line">            LayoutInflater inflater = LayoutInflater.from(mContext);</span><br><span class="line">            <span class="comment">// 装载列表项视图</span></span><br><span class="line">            convertView = inflater.inflate(mResId, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 获取列表项组件</span></span><br><span class="line">        ImageView iconImg = (ImageView) convertView.findViewById(R.id.icon_img);</span><br><span class="line">        TextView titleTv = (TextView) convertView.findViewById(R.id.title_tv);</span><br><span class="line">        TextView infoTv = (TextView) convertView.findViewById(R.id.info_tv);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 给列表项赋值</span></span><br><span class="line">        Data data = getItem(position);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != data) &#123;</span><br><span class="line">            iconImg.setImageResource(data.getIcon());</span><br><span class="line">            titleTv.setText(data.getTitle());</span><br><span class="line">            infoTv.setText(data.getInfo());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> convertView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>经过这样的改造后，getView()方法首先检查convertView是否为空，如果是则新装填一个列表项组件，否则就重用它，就可以避免多余的装载导致的内存开销。</p>
<h4 id="使用持有者模式"><a href="#使用持有者模式" class="headerlink" title="使用持有者模式"></a>使用持有者模式</h4><p>与创建列表项组件的另一个代价较大的操作，就是调用findViewById()方法。这个方法会深入到已装填的行，根据指定的标识符取出对应的组件，便于修改列表项组件的内容，如修改TextView的文本。由于findViewById()方法可以从行所在根视图的所有子组件中找到组件，因此可能需要执行相当多的指令，而在重复取的相同组件的情况下则更是如此。</p>
<p>在某些GUI工具包中，可以通过在程序代码中整体性地声明复合的View对象来避免这个问题。因为在访问这个组件时，无非就是调用getter方法或访问字段。当然，在Android中也可以做到这一点，只不过代码会复杂繁琐一些。一个比较理想的方案就是，仍然使用XML布局，但是又可以缓存行中的关键子组件，也就是只需要查找一次即可，就意味着要使用持有者模式了。</p>
<p>在前面学习View的时候，知道每个View对象都有一个getTag()和setTag()方法，通过这两个方法可以在任何对象与组件之间建立联系。在持有者模式中，Tag标签用来保存对象，而对象又用来保存要使用的子组件。在将持有者添加到视图后，只要用到了行，就可以轻而易举的访问其子组件，而不必再调用findViewById()方法了。</p>
<p>接下来继续在“自定义BaseAdapter”的基础上来开始优化，除了MyBaseAdapter类中增加一个持有者类和修改getView()方法代码，其他不变。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得第position处的列表项组件</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup viewGroup)</span> </span>&#123;</span><br><span class="line">     ViewHolder holder = <span class="keyword">null</span>;</span><br><span class="line">     <span class="keyword">if</span>(<span class="keyword">null</span> == convertView) &#123;</span><br><span class="line">         <span class="comment">// 获取LayoutInflater对象</span></span><br><span class="line">         LayoutInflater inflater = LayoutInflater.from(mContext);</span><br><span class="line">         <span class="comment">// 装载列表项视图</span></span><br><span class="line">         convertView = inflater.inflate(mResId, <span class="keyword">null</span>);</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 新建持有者ViewHolder</span></span><br><span class="line">         holder = <span class="keyword">new</span> ViewHolder();</span><br><span class="line">         <span class="comment">// 获取列表项组件</span></span><br><span class="line">         holder.iconImg = (ImageView) convertView.findViewById(R.id.icon_img);</span><br><span class="line">         holder.titleTv = (TextView) convertView.findViewById(R.id.title_tv);</span><br><span class="line">         holder.infoTv = (TextView) convertView.findViewById(R.id.info_tv);</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 将ViewHolder对象存储到convertView中</span></span><br><span class="line">         convertView.setTag(holder);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// 从convertView取出ViewHolder对象</span></span><br><span class="line">         holder = (ViewHolder) convertView.getTag();</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// 给列表项组件设置内容</span></span><br><span class="line">     Data data = getItem(position);</span><br><span class="line">     <span class="keyword">if</span>(<span class="keyword">null</span> != data) &#123;</span><br><span class="line">         holder.iconImg.setImageResource(data.getIcon());</span><br><span class="line">         holder.titleTv.setText(data.getTitle());</span><br><span class="line">         holder.infoTv.setText(data.getInfo());</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">return</span> convertView;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 持有者类</span></span><br><span class="line"> <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">     ImageView iconImg; <span class="comment">// 图标</span></span><br><span class="line">     TextView titleTv; <span class="comment">// 标题</span></span><br><span class="line">     TextView infoTv; <span class="comment">// 内容</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p> 这里ViewHolder作为持有者类，此处比较简单直接使用没有给出getter和setter方法。当convertView 为空的时候，装填一个列表项组件，并同时创建相应的ViewHolder对象；当convertView 不为空，只需要从其中取出ViewHolder对象，即可轻松给子组件填充内容。</p>
<h4 id="列表头和列表尾的使用"><a href="#列表头和列表尾的使用" class="headerlink" title="列表头和列表尾的使用"></a>列表头和列表尾的使用</h4><p> 在实际使用ListView时，经常会有这样的需求：当位于ListView最顶部的时候，显示一个搜索框可以搜索列表内容，或者显示下拉刷新；当位于ListView最底部的时候，显示一个上拉加载更多的功能。由于这显示的内容同ListView列表项内容不同，可以通过控制position来实现效果，但是非常繁琐，当然Android中提供了ListView的列表头和列表尾功能。</p>
<p>给ListView添加HeadView和FootView，当ListView滑动至列表第一项时使HeadView滑动出现，当ListView滑动至列表最后一项时使FootView滑动出现。</p>
<p>接下来就通过一个示例来学习如何使用ListView列表头和列表尾。仍然在“自定义BaseAdapter”的基础上来完成。</p>
<p>首先设计一个ListView列表头布局list_headview_layout.xml，主要是一个搜索框，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/search_et&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;搜索&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;10dp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接着设计一个ListView列表尾布局list_footview_layout.xml，主要是提示用户上拉加载更多，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:gravity</span>=<span class="string">&quot;center_horizontal&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/prompt_tv&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;上拉加载更多&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后是将上面定义的列表头布局额列表尾布局添加到ListView列表，主要修改Activity类的onCreate方法，其他不变，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取界面组件</span></span><br><span class="line">ListView listView = (ListView) findViewById(R.id.listview);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取列表和列表尾</span></span><br><span class="line">View hearderView = getLayoutInflater().inflate(R.layout.list_headview_layout, <span class="keyword">null</span>);</span><br><span class="line">View footView = getLayoutInflater().inflate(R.layout.list_footview_layout, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给ListView添加列表和列表尾</span></span><br><span class="line">listView.addHeaderView(hearderView);</span><br><span class="line">listView.addFooterView(footView);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将数组包装为自定义MyBaseAdapter</span></span><br><span class="line">MyBaseAdapter adapter = <span class="keyword">new</span> MyBaseAdapter(<span class="keyword">this</span>, getData(), R.layout.custom_baseadapter_item);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为ListView设置Adapter</span></span><br><span class="line">listView.setAdapter(adapter);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里需要注意的是，给ListView添加列表和列表尾的代码必须放在设置Adapter代码之前，否则会报错。</p>
<p>关于列表搜索和加载的功能此处不做过多学习，后期根据需要再进行学习。</p>
<h3 id="ListView数据动态更新"><a href="#ListView数据动态更新" class="headerlink" title="ListView数据动态更新"></a>ListView数据动态更新</h3><p>updatedata_layout.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span> &gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">&quot;center_horizontal&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/add_btn&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;添加&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/update_btn&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;更新&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/delete_btn&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;删除&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/clear_btn&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;清空&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/empty_tv&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;15dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;15sp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;暂无数据&quot;</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/listview&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>updatedata_item.xml文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">              android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">              android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">              android:gravity=<span class="string">&quot;center_vertical&quot;</span></span><br><span class="line">              android:orientation=<span class="string">&quot;horizontal&quot;</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/icon_img&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;48dp&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;48dp&quot;</span></span><br><span class="line">        android:padding=<span class="string">&quot;5dp&quot;</span>/&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/content_tv&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:textSize=<span class="string">&quot;18sp&quot;</span> /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>创建数据实体类UpdateData.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdateData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> imgId;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UpdateData</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UpdateData</span><span class="params">(<span class="keyword">int</span> imgId, String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.imgId = imgId;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getImgId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> imgId;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImgId</span><span class="params">(<span class="keyword">int</span> imgId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.imgId = imgId;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建MyUpdateAdapter类，继承BaseAdapter，再另外添加几个方法，便于操作ListView。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.BaseAdapter;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.jinyu.cqkxzsxy.android.listviewsample.R;</span><br><span class="line"><span class="keyword">import</span> com.jinyu.cqkxzsxy.android.listviewsample.entity.UpdateData;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUpdateAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line">    <span class="keyword">private</span> List&lt;UpdateData&gt; mUpdateData;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyUpdateAdapter</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyUpdateAdapter</span><span class="params">( Context context, List&lt;UpdateData&gt; UpdateDatas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mUpdateData = UpdateDatas;</span><br><span class="line">        <span class="keyword">this</span>.mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加列表项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> position</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> UpdateData</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> position, UpdateData UpdateData)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == mUpdateData) &#123;</span><br><span class="line">            mUpdateData = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        mUpdateData.add(position,UpdateData);</span><br><span class="line">        notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新列表内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> UpdateDatas</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(List&lt;UpdateData&gt; UpdateDatas)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == mUpdateData) &#123;</span><br><span class="line">            mUpdateData = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        mUpdateData.clear();</span><br><span class="line">        mUpdateData.addAll(UpdateDatas);</span><br><span class="line"> </span><br><span class="line">        notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新列表项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> position</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> UpdateData</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> position,UpdateData UpdateData)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mUpdateData != <span class="keyword">null</span> &amp;&amp; position &lt; mUpdateData.size()) &#123;</span><br><span class="line">            mUpdateData.set(position, UpdateData);</span><br><span class="line">        &#125;</span><br><span class="line">        notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除指定列表项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> position</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mUpdateData != <span class="keyword">null</span> &amp;&amp; <span class="number">0</span> != getCount()) &#123;</span><br><span class="line">            mUpdateData.remove(position);</span><br><span class="line">        &#125;</span><br><span class="line">        notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空列表数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mUpdateData != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mUpdateData.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mUpdateData.size();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UpdateData <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mUpdateData.get(position);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">        ViewHolder holder = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == convertView)&#123;</span><br><span class="line">            convertView = LayoutInflater.from(mContext).inflate(R.layout.updatedata_item, <span class="keyword">null</span>);</span><br><span class="line">            holder = <span class="keyword">new</span> ViewHolder();</span><br><span class="line">            holder.img_icon = (ImageView) convertView.findViewById(R.id.icon_img);</span><br><span class="line">            holder.txt_content = (TextView) convertView.findViewById(R.id.content_tv);</span><br><span class="line">            convertView.setTag(holder);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            holder = (ViewHolder) convertView.getTag();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        UpdateData UpdateData = getItem(position);</span><br><span class="line">        holder.img_icon.setImageResource(UpdateData.getImgId());</span><br><span class="line">        holder.txt_content.setText(UpdateData.getContent());</span><br><span class="line">        <span class="keyword">return</span> convertView;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span></span>&#123;</span><br><span class="line">        ImageView img_icon;</span><br><span class="line">        TextView txt_content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 接下来为ListView提供Adapter，使用自定义的BaseAdapter决定ListView所要显示的列表项，然后为4个按钮设置监听监听器。新建UpdateDataActivity.java文件，加载上面新建的布局文件，具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.ListView;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.jinyu.cqkxzsxy.android.listviewsample.adapter.MyUpdateAdapter;</span><br><span class="line"><span class="keyword">import</span> com.jinyu.cqkxzsxy.android.listviewsample.entity.UpdateData;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdateDataActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ListView mListView = <span class="keyword">null</span>; <span class="comment">// 列表</span></span><br><span class="line">    <span class="keyword">private</span> Button mAddBtn = <span class="keyword">null</span>; <span class="comment">// 添加列表项按钮</span></span><br><span class="line">    <span class="keyword">private</span> Button mUpdateBtn = <span class="keyword">null</span>; <span class="comment">// 更新列表按钮</span></span><br><span class="line">    <span class="keyword">private</span> Button mDeleteBtn = <span class="keyword">null</span>; <span class="comment">// 删除列表项按钮</span></span><br><span class="line">    <span class="keyword">private</span> Button mClearBtn = <span class="keyword">null</span>; <span class="comment">// 清空列表数据</span></span><br><span class="line">    <span class="keyword">private</span> MyUpdateAdapter mAdapter = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.updatedata_layout);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 获取界面组件</span></span><br><span class="line">        mListView = (ListView) findViewById(R.id.listview);</span><br><span class="line">        mAddBtn = (Button) findViewById(R.id.add_btn);</span><br><span class="line">        mUpdateBtn = (Button) findViewById(R.id.update_btn);</span><br><span class="line">        mDeleteBtn = (Button) findViewById(R.id.delete_btn);</span><br><span class="line">        mClearBtn = (Button) findViewById(R.id.clear_btn);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 添加列表控内容视图</span></span><br><span class="line">        View emptyView = findViewById(R.id.empty_tv);</span><br><span class="line">        mListView.setEmptyView(emptyView);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 初始化列表</span></span><br><span class="line">        List&lt;UpdateData&gt; datas = <span class="keyword">new</span> LinkedList&lt;UpdateData&gt;();</span><br><span class="line">        mAdapter = <span class="keyword">new</span> MyUpdateAdapter(<span class="keyword">this</span>, datas);</span><br><span class="line">        mListView.setAdapter(mAdapter);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 设置按钮点击事件监听器</span></span><br><span class="line">        mAddBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        mUpdateBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        mDeleteBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        mClearBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (view.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.add_btn:</span><br><span class="line">                addItem();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.update_btn:</span><br><span class="line">                updateData();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.delete_btn:</span><br><span class="line">                deleteItem();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.clear_btn:</span><br><span class="line">                clearData();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加列表项</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> position = getRandomPosition();</span><br><span class="line">        mAdapter.add(position, <span class="keyword">new</span> UpdateData(R.mipmap.ic_launcher, <span class="string">&quot;随机添加&quot;</span> + position));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新列表内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> position = getRandomPosition();</span><br><span class="line">        mAdapter.update(position, <span class="keyword">new</span> UpdateData(R.mipmap.ic_launcher, <span class="string">&quot;更新&quot;</span> + getRandomNumber()));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除列表项</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deleteItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> position = getRandomPosition();</span><br><span class="line">        mAdapter.remove(position);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空列表数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clearData</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mAdapter.clear();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取列表随机位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getRandomPosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = mAdapter.getCount();</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (Math.random() * count);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取100以内的随机数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">getRandomNumber</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.random() * <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改启动的Activity，运行程序，然后点击添加按钮，在列表中随机添加一些列表项，可以看到列表数据动态更新，然后再点击更新按钮，可以随机更新列表数据，再点击删除按钮，可以看到将会从列表中删除随机列表项，点击清空按钮，可以将列表所有数据全部清空，显示启动时的页面。</p>
<p>从以上几个操作，可以看到动态更新时离不开每次调用notifyDataSetChanged()方法，这个方法的主要作用就是当适配器里面的内容发生改变时需要强制调用getView()方法来刷新每个Item的内容。</p>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/cqkxzsxy/article/category/7017381">Android从入门到精通</a></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">平心</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://pingxin0521.gitee.io/2019/04/29/Android-%E5%9F%BA%E7%A1%80-8/">https://pingxin0521.gitee.io/2019/04/29/Android-%E5%9F%BA%E7%A1%80-8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://pingxin0521.gitee.io" target="_blank">平心de小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/04/30/JavaScript-%E5%9F%BA%E7%A1%80-1/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JavaScript 入门和变量</div></div></a></div><div class="next-post pull-right"><a href="/2019/04/29/Java-%E5%9F%BA%E7%A1%80-10-4/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/vCnKyoFJZ1g4XYR.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">java 日期</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2019/06/03/Android-基础-22/" title="Android  常见错误"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/vCnKyoFJZ1g4XYR.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2020-05-16</div><div class="title">Android  常见错误</div></div></a></div><div><a href="/2019/04/27/Android-基础-4/" title="Android 用户界面状态保存"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-07-02</div><div class="title">Android 用户界面状态保存</div></div></a></div><div><a href="/2019/04/30/Android-基础-13/" title="Android  菜单"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-07-02</div><div class="title">Android  菜单</div></div></a></div><div><a href="/2019/04/30/Android-基础-11/" title="Android  高级控件（一）"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/7dHvepmfYOLWTrX.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-07-02</div><div class="title">Android  高级控件（一）</div></div></a></div><div><a href="/2019/04/27/Android-基础-3/" title="Android  Intent和Application"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-07-02</div><div class="title">Android  Intent和Application</div></div></a></div><div><a href="/2019/04/28/Android-基础-5/" title="Android 常用基本控件"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/vCnKyoFJZ1g4XYR.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-05-08</div><div class="title">Android 常用基本控件</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://s2.ax1x.com/2020/02/11/1ovw6J.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">平心</div><div class="author-info__description">年轻人的life、learn and think</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">449</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">77</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">68</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hanyunpeng0521"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hanyunpeng0521" target="_blank" title="Github"><i class="fa fa-github"></i></a><a class="social-icon" href="mailto:m13839441583@163.com" target="_blank" title="Email"><i class="fa fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title=""><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">为什么呢？开始提问吧</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ListView"><span class="toc-number">1.</span> <span class="toc-text">ListView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Adapter"><span class="toc-number">2.</span> <span class="toc-text">Adapter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MVC"><span class="toc-number">2.1.</span> <span class="toc-text">MVC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Adapter-1"><span class="toc-number">2.2.</span> <span class="toc-text">Adapter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListActivity"><span class="toc-number">3.</span> <span class="toc-text">ListActivity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%97%E8%A1%A8%E9%A1%B9"><span class="toc-number">4.</span> <span class="toc-text">自定义列表项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89ArrayAdapter"><span class="toc-number">5.</span> <span class="toc-text">自定义ArrayAdapter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleAdapter"><span class="toc-number">6.</span> <span class="toc-text">SimpleAdapter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89BaseAdapter"><span class="toc-number">7.</span> <span class="toc-text">自定义BaseAdapter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListView%E4%BC%98%E5%8C%96%E5%92%8C%E5%88%97%E8%A1%A8%E9%A6%96%E5%B0%BE%E4%BD%BF%E7%94%A8"><span class="toc-number">8.</span> <span class="toc-text">ListView优化和列表首尾使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8convertView"><span class="toc-number">8.1.</span> <span class="toc-text">使用convertView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8C%81%E6%9C%89%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.2.</span> <span class="toc-text">使用持有者模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E5%A4%B4%E5%92%8C%E5%88%97%E8%A1%A8%E5%B0%BE%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">8.3.</span> <span class="toc-text">列表头和列表尾的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ListView%E6%95%B0%E6%8D%AE%E5%8A%A8%E6%80%81%E6%9B%B4%E6%96%B0"><span class="toc-number">9.</span> <span class="toc-text">ListView数据动态更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A"><span class="toc-number">10.</span> <span class="toc-text">参考：</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/05/15/node-2-4/" title="Egg.js -- 为企业级框架和应用而生"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/okfOw28KlZFbE7z.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Egg.js -- 为企业级框架和应用而生"/></a><div class="content"><a class="title" href="/2021/05/15/node-2-4/" title="Egg.js -- 为企业级框架和应用而生">Egg.js -- 为企业级框架和应用而生</a><time datetime="2021-05-15T10:18:59.000Z" title="发表于 2021-05-15 18:18:59">2021-05-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/30/node-2-3/" title="Koa -- 基于Node.js平台的下一代Web开发框架"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/HjVAdIuT7bZJypS.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Koa -- 基于Node.js平台的下一代Web开发框架"/></a><div class="content"><a class="title" href="/2021/04/30/node-2-3/" title="Koa -- 基于Node.js平台的下一代Web开发框架">Koa -- 基于Node.js平台的下一代Web开发框架</a><time datetime="2021-04-30T10:18:59.000Z" title="发表于 2021-04-30 18:18:59">2021-04-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/01/node-2-1/" title="Node.JS web开发前置知识"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Node.JS web开发前置知识"/></a><div class="content"><a class="title" href="/2021/04/01/node-2-1/" title="Node.JS web开发前置知识">Node.JS web开发前置知识</a><time datetime="2021-04-01T03:18:59.000Z" title="发表于 2021-04-01 11:18:59">2021-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-1/" title="第十一周--谷歌浏览器插件"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第十一周--谷歌浏览器插件"/></a><div class="content"><a class="title" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-1/" title="第十一周--谷歌浏览器插件">第十一周--谷歌浏览器插件</a><time datetime="2020-12-26T10:18:59.000Z" title="发表于 2020-12-26 18:18:59">2020-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-0/" title="第十一周--浏览器技术"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/vCnKyoFJZ1g4XYR.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第十一周--浏览器技术"/></a><div class="content"><a class="title" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-0/" title="第十一周--浏览器技术">第十一周--浏览器技术</a><time datetime="2020-12-26T06:18:59.000Z" title="发表于 2020-12-26 14:18:59">2020-12-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 平心</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '4lfIXzqxaC1ONs0MJO4oHu07-gzGzoHsz',
      appKey: 'qw99Bw8FD0KVKU9m457CwWsr',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>