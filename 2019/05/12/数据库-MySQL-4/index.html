<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MySQL SQL 函数（五） | 平心de小屋</title><meta name="keywords" content="数据库,MySQL,SQL"><meta name="author" content="平心"><meta name="copyright" content="平心"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="常用函数MySQL中常用函数很多，其实不要死记硬背，记住常用的几个，其他查看即可。">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL SQL 函数（五）">
<meta property="og:url" content="https://pingxin0521.gitee.io/2019/05/12/%E6%95%B0%E6%8D%AE%E5%BA%93-MySQL-4/index.html">
<meta property="og:site_name" content="平心de小屋">
<meta property="og:description" content="常用函数MySQL中常用函数很多，其实不要死记硬背，记住常用的几个，其他查看即可。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg">
<meta property="article:published_time" content="2019-05-12T06:08:59.000Z">
<meta property="article:modified_time" content="2019-11-18T07:48:12.378Z">
<meta property="article:author" content="平心">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg"><link rel="shortcut icon" href="https://s2.ax1x.com/2020/02/11/1ovFOA.png"><link rel="canonical" href="https://pingxin0521.gitee.io/2019/05/12/%E6%95%B0%E6%8D%AE%E5%BA%93-MySQL-4/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL SQL 函数（五）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2019-11-18 15:48:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://s2.ax1x.com/2020/02/11/1ovw6J.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">449</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">77</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">68</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">平心de小屋</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL SQL 函数（五）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-05-12T06:08:59.000Z" title="发表于 2019-05-12 14:08:59">2019-05-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2019-11-18T07:48:12.378Z" title="更新于 2019-11-18 15:48:12">2019-11-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">MySQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL SQL 函数（五）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h3><p>MySQL中常用函数很多，其实不要死记硬背，记住常用的几个，其他查看即可。</p>
<span id="more"></span>

<h4 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h4><p>使用格式：一般用于插入、修改语句中，直接 函数（参数） 即可，把返回结果用于插入、修改。</p>
<ul>
<li>RAND（）：随机数生成。区别在于，RAND()返回的数是完全随机的，而RAND(x)在x相同时返回的值相同</li>
<li>ROUND(X,Y):得到X的Y位四舍五入小数。</li>
<li>LOG（x，y）:得到以x为底，y的对数。</li>
<li>SQRT（x）：得到x的平方根。</li>
<li>MOD(x,y)：x对y求余。</li>
<li>CEIL(x)、CEILING(x)：向上取整。</li>
<li>FLOOR(x)：向下取整。</li>
<li>ROUND(x)：返回离x最近的整数，也就是对x进行四舍五入处理</li>
<li>SIGN(x)返回x的符号，-1为负数，0不变，1为正数</li>
<li>POW(x,y)、POWER(x,y)：幂运算，求x的y次方幂。</li>
</ul>
<p>应用实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into test values (RAND(0),ROUND(4.5462,3),LOG(2,8),SQRT(9));</span><br><span class="line">select * from test;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0,4.54600000000000000000000000000,3.0000000000000000000000000000000,3.0000000000000000000000000000000</span><br></pre></td></tr></table></figure>
<h4 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h4><p>使用格式：聚集函数一般是配合GROUP BY语句使用的，也可以用于统计整表、整列。</p>
<ul>
<li>AVG() ：    返回某列的平均值</li>
<li>COUNT()：    返回某列/某组/整表的行数（即记录数）</li>
<li>MAX()     ：返回某列的最大值</li>
<li>MIN()     ：返回某列的最小值</li>
<li>SUM()     ：返回某个列之和</li>
</ul>
<p>样例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select COUNT（*）  from test GROUP BY id;</span><br><span class="line">select AVG(grade) from student;</span><br><span class="line">select MAX(grade) from student;</span><br><span class="line">select MIN(grade) from student;</span><br><span class="line">select SUM(grade) from student;</span><br></pre></td></tr></table></figure>
<h4 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h4><p>字符串函数的使用格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 函数(参数) from 表;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>CONCAT(str1,str2,…) ：返回结果为连接参数产生的字符串。如有任何一个参数为NULL ，则返回值为 NULL。</p>
</li>
<li><p>ASCII(str)：返回字符串str 的最左字符的数值。假如str为空字符串，则返回值为 0 。假如str 为NULL，则返回值为 NULL。 ASCII()用于带有从 0到255的数值的字符。</p>
</li>
<li><p>BIN(N)：返回N的二进制值的字符串。</p>
</li>
<li><p>CHAR_LENGTH(str)：返回值为字符串str 的长度，长度的单位为字符。</p>
</li>
<li><p>CONV(str,from_base,to_base)：不同进制的转换。返回str字符串由from_base进制转化为 to_base 进制的数字串表示。</p>
</li>
<li><p>ELT(N,str1,str2,str3,…)：返回第一个参数后面的第N个参数。返回若N = 1，则返回值为  str1 ，若N = 2，则返回值为 str2 ，以此类推。</p>
</li>
<li><p>FIELD(str,str1,str2,str3,…)：返回str1, str2, str3,……列表中的str 的个数。在找不到str 的情况下，返回值为 0 。</p>
</li>
<li><p>FIND_IN_SET(str,strlist)：假如字符串str 在字符串列表strlist 中， 则返回其在列表中的位置。一个字符串列表就是一个由一些被‘,’符号分开的自链组成的字符串。</p>
</li>
<li><p>FORMAT(X,D)：将number X设置为格式 ‘#,###,###.##’, 以四舍五入的方式保留到小数点后D位, 而返回结果为一个字符串。</p>
</li>
<li><p>INSERT(str,pos,len,newstr)：字符串 str的pos到len长的位置被newstr替换。</p>
</li>
<li><p>INSTR(str,substr)：返回字符串 str 中子字符串substr的第一个出现位置。</p>
</li>
<li><p>POSITION(substr IN str)：返回子串substr在字符串str第一个出现的位置，如果substr不是在str里面，返回0。</p>
</li>
<li><p>LOCATE(substr,str,pos)返回子串substr在字符串str第一个出现的位置，从位置pos开始。如果substr不是在str里面，返回0。</p>
</li>
<li><p>LEFT(str,len)：返回字符串str 从左起len长的子串。</p>
</li>
<li><p>RIGHT(str,len)：从字符串str 开始，返回最右len 字符。</p>
</li>
<li><p>LENGTH(str)：返回值为字符串str 的长度，单位为字节。</p>
</li>
<li><p>LOWER(str)：把str全部变为小写。</p>
</li>
<li><p>REPEAT(str,count)：str重复count次而成的新字符串。</p>
</li>
<li><p>REPLACE(str,from_str,to_str)：把str中的from_str内容替换为to_str.</p>
</li>
<li><p>REVERSE(str)：把str倒序。</p>
</li>
<li><p>RPAD(str,len,padstr)：把str用padstr填充到len长。</p>
</li>
<li><p>SUBSTRING(str,pos) , SUBSTRING(str FROM pos)：字符串str返回一个子字符串，起始于位置 pos。</p>
</li>
<li><p>SUBSTRING(str,pos,len) , SUBSTRING(str FROM pos FOR len)：字符串str返回一个长度同len字符相同的子字符串，起始于位置 pos。</p>
</li>
<li><p>TRIM([{BOTH | LEADING | TRAILING} [remstr] FROM] str) ，TRIM(remstr FROM str)：从str中删除remstr。</p>
</li>
<li><p>UPPER(str)：把str转为大写。</p>
</li>
</ul>
<h4 id="日期和时间函数"><a href="#日期和时间函数" class="headerlink" title="日期和时间函数"></a>日期和时间函数</h4><ul>
<li><p>NOW():返回该条语句【注意，是该条语句，而不是该函数。区别在于下面的sysdate（）函数】运行时的具体日期时间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eg:select NOW();</span><br><span class="line"></span><br><span class="line">re：2016-09-12 21:25:06</span><br></pre></td></tr></table></figure></li>
<li><p>sysdate()： 日期时间函数跟 now() 类似，不同之处在于：now() 在语句执行开始时值就得到了， sysdate() 在函数执行时动态得到值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select now(), sleep(3), now();</span><br><span class="line"></span><br><span class="line">+---------------------+----------+---------------------+</span><br><span class="line">| now()               | sleep(3) | now()               |</span><br><span class="line">+---------------------+----------+---------------------+</span><br><span class="line">| 2008-08-08 22:28:21 |        0 | 2008-08-08 22:28:21 |</span><br><span class="line">+---------------------+----------+---------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select sysdate(), sleep(3), sysdate();</span><br><span class="line"></span><br><span class="line">+---------------------+----------+---------------------+</span><br><span class="line">| sysdate()           | sleep(3) | sysdate()           |</span><br><span class="line">+---------------------+----------+---------------------+</span><br><span class="line">| 2008-08-08 22:28:41 |        0 | 2008-08-08 22:28:44 |</span><br><span class="line">+---------------------+----------+---------------------+</span><br></pre></td></tr></table></figure>
<p>可以看到，虽然中途 sleep 3 秒，但 now() 函数两次的时间值是相同的； sysdate() 函数两次得到的时间值相差 3 秒。</p>
</li>
<li><p>curdate()：获取当前日期。</p>
</li>
<li><p>curtime()：获得当前时间（time）函数。</p>
</li>
<li><p>时间选取函数：<br>选取日期时间的各个部分：日期、时间、年、季度、月、日、小时、分钟、秒、微秒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">set @dt = &#x27;2018-09-10 07:15:30.123456&#x27;;</span><br><span class="line"></span><br><span class="line">select date(@dt);        -- 2008-09-10</span><br><span class="line">select time(@dt);        -- 07:15:30.123456</span><br><span class="line">select year(@dt);        -- 2008</span><br><span class="line">select quarter(@dt);     -- 3</span><br><span class="line">select month(@dt);       -- 9</span><br><span class="line">select week(@dt);        -- 36</span><br><span class="line">select day(@dt);         -- 10</span><br><span class="line">select hour(@dt);        -- 7</span><br><span class="line">select minute(@dt);      -- 15</span><br><span class="line">select second(@dt);      -- 30</span><br><span class="line">select microsecond(@dt); -- 123456</span><br><span class="line"></span><br><span class="line">dayname(), monthname()： 返回星期和月份名称。</span><br><span class="line">select dayname(@dt);     -- Friday</span><br><span class="line">select monthname(@dt);   -- August：</span><br></pre></td></tr></table></figure></li>
<li><p>WEEKDAY(date) ：返回date的星期索引(0=星期一，1=星期二, ……6= 星期天)。</p>
</li>
<li><p>DAYOFMONTH(date) ：返回date的月份中日期，在1到31范围内。</p>
</li>
<li><p>DAYOFYEAR(date) ：返回date在一年中的日数, 在1到366范围内。</p>
</li>
<li><p>MONTH(date) ：返回date的月份，范围1到12。</p>
</li>
<li><p>DAYNAME(date) ：返回date的星期名字，比如：Friday。</p>
</li>
<li><p>MONTHNAME(date) ：返回date的月份名字。</p>
</li>
<li><p>QUARTER(date) ：返回date一年中的季度，范围1到4。</p>
</li>
</ul>
<h4 id="加密解密函数"><a href="#加密解密函数" class="headerlink" title="加密解密函数"></a>加密解密函数</h4><ul>
<li><p>ENCODE(,)   DECODE(,)：加密解密字符串。该函数有两个参数：被加密或解密的字符串和作为加密或解密基础的密钥。Encode结果是一个二进制字符串，以BLOB类型存储。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加密 INSERT INTO users (username, password) VALUES (&#x27;joe&#x27;, ENCODE(&#x27;guessme&#x27;, &#x27;abracadabra&#x27;));</span><br><span class="line">解密 SELECT DECODE(password, &#x27;abracadabra&#x27;) FROM users WHERE username=&#x27;joe&#x27;;</span><br></pre></td></tr></table></figure></li>
<li><p>MD5()：计算字符串的MD5校验和（128位）。</p>
</li>
<li><p>SHA()：计算字符串的SHA校验和（160位）</p>
</li>
</ul>
<h4 id="格式化函数"><a href="#格式化函数" class="headerlink" title="格式化函数"></a>格式化函数</h4><ul>
<li><p>FORMAT(x,y) ：把x格式化以逗号分隔开的数字序列，y是结果的小数位数。同时，结果会以 , 每3位数进行分割，像金额表达一样。</p>
</li>
<li><p>DATE_FORMAT(date,fmt) 和TIME_FORMAT(time,fmt)函数可以用来格式化日期和时间值：这俩函数接受日期或者时间值和一个指定结果格式的格式化字符串。这个格式化字符串包含特殊的符号。不同的符号表示不同的内容，字符串就是一系列自选的符号组成，这样日期或时间就会按照字符串表示的格式表达出来。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>说明符</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>%a</td>
<td>工作日的缩写名称  (Sun..Sat)</td>
</tr>
<tr>
<td>%b</td>
<td>月份的缩写名称 (Jan..Dec)</td>
</tr>
<tr>
<td>%c</td>
<td>月份，数字形式(0..12)</td>
</tr>
<tr>
<td>%D</td>
<td>带有英语后缀的该月日期 (0th, 1st, 2nd, 3rd, …)</td>
</tr>
<tr>
<td>%d</td>
<td>该月日期, 数字形式 (00..31)</td>
</tr>
<tr>
<td>%e</td>
<td>该月日期, 数字形式(0..31)</td>
</tr>
<tr>
<td>%f</td>
<td>微秒 (000000..999999)</td>
</tr>
<tr>
<td>%H</td>
<td>小时(00..23)</td>
</tr>
<tr>
<td>%h</td>
<td>小时(01..12)</td>
</tr>
<tr>
<td>%I</td>
<td>小时 (01..12)</td>
</tr>
<tr>
<td>%i</td>
<td>分钟,数字形式 (00..59)</td>
</tr>
<tr>
<td>%j</td>
<td>一年中的天数 (001..366)</td>
</tr>
<tr>
<td>%k</td>
<td>小时 (0..23)</td>
</tr>
<tr>
<td>%l</td>
<td>小时 (1..12)</td>
</tr>
<tr>
<td>%M</td>
<td>月份名称 (January..December)</td>
</tr>
<tr>
<td>%m</td>
<td>月份, 数字形式 (00..12)</td>
</tr>
<tr>
<td>%p</td>
<td>上午（AM）或下午（ PM）</td>
</tr>
<tr>
<td>%r</td>
<td>时间 , 12小时制 (小时hh:分钟mm:秒数ss 后加 AM或PM)</td>
</tr>
<tr>
<td>%S</td>
<td>秒 (00..59)</td>
</tr>
<tr>
<td>%s</td>
<td>秒 (00..59)</td>
</tr>
<tr>
<td>%T</td>
<td>时间 , 24小时制 (小时hh:分钟mm:秒数ss)</td>
</tr>
<tr>
<td>%U</td>
<td>周 (00..53), 其中周日为每周的第一天</td>
</tr>
<tr>
<td>%u</td>
<td>周 (00..53), 其中周一为每周的第一天</td>
</tr>
<tr>
<td>%V</td>
<td>周 (01..53), 其中周日为每周的第一天 ; 和 %X同时使用</td>
</tr>
<tr>
<td>%v</td>
<td>周 (01..53), 其中周一为每周的第一天 ; 和 %x同时使用</td>
</tr>
<tr>
<td>%W</td>
<td>工作日名称 (周日..周六)</td>
</tr>
<tr>
<td>%w</td>
<td>一周中的每日 (0=周日..6=周六)</td>
</tr>
<tr>
<td>%X</td>
<td>该周的年份，其中周日为每周的第一天, 数字形式,4位数;和%V同时使用</td>
</tr>
<tr>
<td>%x</td>
<td>该周的年份，其中周一为每周的第一天, 数字形式,4位数;和%v同时使用</td>
</tr>
<tr>
<td>%Y</td>
<td>年份, 数字形式,4位数</td>
</tr>
<tr>
<td>%y</td>
<td>年份, 数字形式 (2位数)</td>
</tr>
<tr>
<td>%%</td>
<td>‘%’文字字符</td>
</tr>
</tbody></table>
<h4 id="类型转换函数"><a href="#类型转换函数" class="headerlink" title="类型转换函数"></a>类型转换函数</h4><p>CAST() 和CONVERT() 函数可用来获取一个类型的值，并产生另一个类型的值。</p>
<p>格式：CAST(xxx  AS   类型)  ,   CONVERT(xxx,类型)</p>
<p>类型 可以是以下值其中的 一个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">二进制 : BINARY    </span><br><span class="line">字符型,可带参数 : CHAR()     </span><br><span class="line">日期 : DATE     </span><br><span class="line">时间: TIME     </span><br><span class="line">日 期时间型 : DATETIME     </span><br><span class="line">浮点数 : DECIMAL      </span><br><span class="line">整数 : SIGNED     </span><br><span class="line">无符号整数 : UNSIGNED</span><br></pre></td></tr></table></figure>
<h4 id="系统信息函数"><a href="#系统信息函数" class="headerlink" title="系统信息函数"></a>系统信息函数</h4><p>使用格式：select 函数();</p>
<ul>
<li>VERSION()：返回数据库版本号。</li>
<li>CONNECTION_ID():返回数据库的连接次数.</li>
<li>DATABASE()、SCHEMA():返回当前数据库名</li>
<li>USER()、SYSTEM_USER()、SESSION_USER()，CURRENT_USER()、CURRENT_USER:返回当前用户名</li>
<li>CHARSET(str)：返回字符串str的字符集（编码格式）</li>
<li>LAST_INSERT_ID() ：返回最近生成的AUTO_INCREMENT值.</li>
</ul>
<h4 id="排名函数"><a href="#排名函数" class="headerlink" title="排名函数"></a>排名函数</h4><p>如下表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employee(salary int,time_length int);</span><br><span class="line">INSERT INTO employee VALUES(1,10),(2,9),(3,4),(3,8),(5,7),(6,1),(7,3),(8,2);</span><br></pre></td></tr></table></figure>

<ol>
<li><p>row_number<br>row_number在排名时序号连续不重复，即使遇到表中的两个3时亦如此</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select row_number() OVER(order by e.salary desc) as row_num , e.salary from employee e</span><br><span class="line"></span><br><span class="line">+-----------+----------+</span><br><span class="line">|   row_num |   salary |</span><br><span class="line">|-----------+----------|</span><br><span class="line">|         1 |        8 |</span><br><span class="line">|         2 |        7 |</span><br><span class="line">|         3 |        6 |</span><br><span class="line">|         4 |        5 |</span><br><span class="line">|         5 |        3 |</span><br><span class="line">|         6 |        3 |</span><br><span class="line">|         7 |        2 |</span><br><span class="line">|         8 |        1 |</span><br><span class="line">+-----------+----------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意：在使用row_number实现分页时需要特别注意一点，over子句中的order by 要与Sql排序记录中的order by 保持一致，否则得到的序号可能不是连续的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select row_number() OVER(order by e.salary desc) as row_num , e.salary</span><br><span class="line">from employee e</span><br><span class="line">order by e.time_length</span><br><span class="line"></span><br><span class="line">+-----------+----------+</span><br><span class="line">|   row_num |   salary |</span><br><span class="line">|-----------+----------|</span><br><span class="line">|         3 |        6 |</span><br><span class="line">|         1 |        8 |</span><br><span class="line">|         2 |        7 |</span><br><span class="line">|         5 |        3 |</span><br><span class="line">|         4 |        5 |</span><br><span class="line">|         6 |        3 |</span><br><span class="line">|         7 |        2 |</span><br><span class="line">|         8 |        1 |</span><br><span class="line">+-----------+----------+</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>rank</p>
<p>rank函数会把要求排序的值相同的归为一组且每组序号一样，排序不会连续</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select rank() OVER(order by e.salary desc) as row_num , e.salary from employee e</span><br><span class="line"></span><br><span class="line">+-----------+----------+</span><br><span class="line">|   row_num |   salary |</span><br><span class="line">|-----------+----------|</span><br><span class="line">|         1 |        8 |</span><br><span class="line">|         2 |        7 |</span><br><span class="line">|         3 |        6 |</span><br><span class="line">|         4 |        5 |</span><br><span class="line">|         5 |        3 |</span><br><span class="line">|         5 |        3 |</span><br><span class="line">|         7 |        2 |</span><br><span class="line">|         8 |        1 |</span><br><span class="line">+-----------+----------+</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>dense_rank</p>
<p>dense_rank排序是连续的，也会把相同的值分为一组且每组排序号一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">select dense_rank() OVER(order by e.salary desc) as row_num , e.salary from employee e</span><br><span class="line">+-----------+----------+</span><br><span class="line">|   row_num |   salary |</span><br><span class="line">|-----------+----------|</span><br><span class="line">|         1 |        8 |</span><br><span class="line">|         2 |        7 |</span><br><span class="line">|         3 |        6 |</span><br><span class="line">|         4 |        5 |</span><br><span class="line">|         5 |        3 |</span><br><span class="line">|         5 |        3 |</span><br><span class="line">|         6 |        2 |</span><br><span class="line">|         7 |        1 |</span><br><span class="line">+-----------+----------+</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>NTILE</p>
<p>NTILE(group_num)将所有记录分成group_num个组，每组序号一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select NTILE(2) OVER(order by e.salary desc) as row_num , e.salary from employee e</span><br><span class="line">+-----------+----------+</span><br><span class="line">|   row_num |   salary |</span><br><span class="line">|-----------+----------|</span><br><span class="line">|         1 |        8 |</span><br><span class="line">|         1 |        7 |</span><br><span class="line">|         1 |        6 |</span><br><span class="line">|         1 |        5 |</span><br><span class="line">|         2 |        3 |</span><br><span class="line">|         2 |        3 |</span><br><span class="line">|         2 |        2 |</span><br><span class="line">|         2 |        1 |</span><br><span class="line">+-----------+----------+</span><br></pre></td></tr></table></figure></li>
</ol>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">create table students(</span><br><span class="line">	id int(4)  auto_increment primary key,</span><br><span class="line">	name varchar(50) not null, </span><br><span class="line">	score int(4) not null</span><br><span class="line">	);</span><br><span class="line">	</span><br><span class="line">insert into students(name,score) values(&#x27;curry&#x27;, 100),</span><br><span class="line">	(&#x27;klay&#x27;, 99),</span><br><span class="line">	(&#x27;KD&#x27;, 100), </span><br><span class="line">	(&#x27;green&#x27;, 90), </span><br><span class="line">	(&#x27;James&#x27;, 99), </span><br><span class="line">	(&#x27;AD&#x27;, 96);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">select id, name, rank() over(order by score desc) as r from students;</span><br><span class="line">select id, name, DENSE_RANK() OVER(order by score desc) as dense_r from students;</span><br><span class="line">select id, name, row_number() OVER(order by score desc) as row_r from students;</span><br><span class="line"></span><br><span class="line">select id, name,score, rank() over(order by score desc) as r,</span><br><span class="line">	DENSE_RANK() OVER(order by score desc) as dense_r,</span><br><span class="line">	row_number() OVER(order by score desc) as row_r</span><br><span class="line">from students;</span><br><span class="line"></span><br><span class="line">-- 需要注意的一点是as后的别名，千万不要与前面的函数名重名，否则会报错。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="自定义函数UDF"><a href="#自定义函数UDF" class="headerlink" title="自定义函数UDF"></a>自定义函数UDF</h3><p>函数存储着一系列sql语句，调用函数就是一次性执行这些语句。所以函数可以降低语句重复。【但注意的是函数注重返回值，不注重执行过程，所以一些语句无法执行。所以函数并不是单纯的sql语句集合。】</p>
<p>UDF可以实现的功能不止于此,UDF有两个关键点,一个是参数,一个是返回值,UDF可以没有参数,但UDF必须有且只有一个返回值</p>
<p>函数与存储过程的区别：函数只会返回一个值，不允许返回一个结果集。函数强调返回值，所以函数不允许返回多个值的情况，即使是查询语句。</p>
<p><strong>创建</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create function 函数名([参数列表]) returns 数据类型</span><br><span class="line">begin</span><br><span class="line"> sql语句;</span><br><span class="line"> return 值;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<p>参数列表的格式是：  变量名 数据类型</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- 最简单的仅有一条sql的函数</span><br><span class="line">create function myselect2() returns int return 666;</span><br><span class="line">select myselect2(); -- 调用函数</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION simpleFun() RETURNS VARCHAR(20) RETURN &quot;Hello World!&quot;;</span><br><span class="line"></span><br><span class="line">select simpleFun();</span><br><span class="line"></span><br><span class="line">--</span><br><span class="line">create function myselect3() returns int</span><br><span class="line">begin</span><br><span class="line">    declare c int;</span><br><span class="line">    select id from class where cname=&quot;python&quot; into c;</span><br><span class="line">    return c;</span><br><span class="line">end;</span><br><span class="line">select myselect3();</span><br><span class="line">-- 带传参的函数</span><br><span class="line">create function myselect5(name varchar(15)) returns int</span><br><span class="line">begin</span><br><span class="line">    declare c int;</span><br><span class="line">    select id from class where cname=name into c;</span><br><span class="line">    return c;</span><br><span class="line">end;</span><br><span class="line">select myselect5(&quot;python&quot;);</span><br></pre></td></tr></table></figure>

<p>报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(1418, &#x27;This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled (you *might* want to use the less safe log_bin_trust_function_creators variable)&#x27;)</span><br><span class="line"></span><br><span class="line">因为CREATE PROCEDURE, CREATE FUNCTION, ALTER PROCEDURE,ALTER FUNCTION,CALL, DROP PROCEDURE, DROP FUNCTION等语句都会被写进二进制日志,然后在从服务器上执行。但是，一个执行更新的不确定子程序(存储过程、函数、触发器)是不可重复的，在从服务器上执行(相对与主服务器是重复执行)可能会造成恢复的数据与原始数据不同，从服务器不同于主服务器的情况。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解决办法也有两种，</p>
<ol>
<li><p>第一种是在创建子程序(存储过程、函数、触发器)时，声明为DETERMINISTIC或NO SQL与READS SQL DATA中的一个，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE DEFINER = CURRENT_USER PROCEDURE `NewProc`()</span><br><span class="line">    DETERMINISTIC</span><br><span class="line">BEGIN</span><br><span class="line"> #Routine body goes here...</span><br><span class="line">END;;</span><br></pre></td></tr></table></figure></li>
<li><p>第二种是信任子程序的创建者，禁止创建、修改子程序时对SUPER权限的要求，设置log_bin_trust_routine_creators全局系统变量为1。设置方法有三种:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.在客户端上执行SET GLOBAL log_bin_trust_function_creators = 1;</span><br><span class="line">2.MySQL启动时，加上–log-bin-trust-function-creators选贤，参数设置为1</span><br><span class="line">3.在MySQL配置文件my.ini或my.cnf中的[mysqld]段上加log-bin-trust-function-creators=1</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>调用</strong><br>直接使用函数名()就可以调用【虽然这么说，但返回的是一个结果，sql中不使用select的话任何结果都无法显示出来（所以单纯调用会报错），】<br>如果想要传入参数可以使用函数名(参数)<br>调用方式【下面调用的函数都是上面中创建的。】：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 无参调用</span><br><span class="line">select myselect3();</span><br><span class="line">-- 传参调用</span><br><span class="line">select myselect5(&quot;python&quot;);</span><br><span class="line">select * from class where id=myselect5(&quot;python&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>查看</strong></p>
<p>查看函数创建语句：<code>show create function 函数名;</code></p>
<p>查看所有函数：<code>show function status [like &#39;pattern&#39;];</code></p>
<p><strong>修改</strong></p>
<p>函数的修改只能修改一些如comment的选项，不能修改内部的sql语句和参数列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter function 函数名 选项；</span><br></pre></td></tr></table></figure>

<p><strong>删除</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop function 函数名;</span><br></pre></td></tr></table></figure>


<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><p>在函数体中我们可以使用更为复杂的语法,比如复合结构/流程控制/任何SQL语句/定义变量等等。</p>
<p>在函数体中,如果包含多条语句,我们需要把多条语句放到BEGIN…END语句块中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line">CREATE FUNCTION IF EXIST deleteById(uid SMALLINT UNSIGNED)</span><br><span class="line">RETURNS VARCHAR(20)</span><br><span class="line">BEGIN</span><br><span class="line">DELETE FROM son WHERE id = uid;</span><br><span class="line">RETURN (SELECT COUNT(id) FROM son);</span><br><span class="line">END//</span><br></pre></td></tr></table></figure>
<p>DELIMITER // 意思是修改默认的结束符”;”为”//“,以后的SQL语句都要以”//“作为结尾</p>
<p>特别说明:UDF中,REURN语句也包含在BEGIN…END中</p>
<p><strong>自定义函数中定义局部变量语法:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE var_name[,varname]...date_type [DEFAULT VALUE];</span><br></pre></td></tr></table></figure>
<p>简单来说就是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE 变量1[,变量2,... ]变量类型 [DEFAULT 默认值]</span><br></pre></td></tr></table></figure>
<p>这些变量的作用范围是在BEGIN…END程序中,而且定义局部变量语句必须在BEGIN…END的第一行定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION addTwoNumber(x SMALLINT UNSIGNED, Y SMALLINT UNSIGNED)</span><br><span class="line">RETURNS SMALLINT</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE a, b SMALLINT UNSIGNED DEFAULT 10;</span><br><span class="line">SET  a = x, b = y;</span><br><span class="line">RETURN a+b;</span><br><span class="line">END//</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">SELECT addTwoNumber(1,2);</span><br><span class="line"></span><br><span class="line">DROP FUNCTION addTwoNumber;</span><br></pre></td></tr></table></figure>
<p>上边的代码只是把两个数相加,当然,没有必要这么写,只是说明局部变量的用法,还是要说明下:这些局部变量的作用范围是在BEGIN…END程序中</p>
<p><strong>为变量赋值语法:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET parameter_name = value[,parameter_name = value...]</span><br><span class="line"></span><br><span class="line">SELECT  INTO parameter_name</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DECLARE x int;</span><br><span class="line">SELECT COUNT(id) FROM tdb_name INTO x;</span><br><span class="line">RETURN x;</span><br><span class="line">END//</span><br></pre></td></tr></table></figure>

<p><strong>用户变量定义语法:(可以理解成全局变量)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SET @param_name = value</span><br><span class="line"></span><br><span class="line">SET @allParam = 100;</span><br><span class="line">SELECT @allParam;</span><br></pre></td></tr></table></figure>
<p>上述定义并显示@allParam用户变量,其作用域只为当前用户的客户端有效</p>
<p><strong>自定义函数中流程控制语句语法:</strong></p>
<p>存储过程和函数中可以使用流程控制来控制语句的执行。</p>
<p>MySQL中可以使用IF语句、CASE语句、LOOP语句、LEAVE语句、ITERATE语句、REPEAT语句和WHILE语句来进行流程控制。</p>
<p>每个流程中可能包含一个单独语句，或者是使用BEGIN…END构造的复合语句，构造可以被嵌套</p>
<p>参考存储过程章节。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">平心</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://pingxin0521.gitee.io/2019/05/12/%E6%95%B0%E6%8D%AE%E5%BA%93-MySQL-4/">https://pingxin0521.gitee.io/2019/05/12/%E6%95%B0%E6%8D%AE%E5%BA%93-MySQL-4/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://pingxin0521.gitee.io" target="_blank">平心de小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a><a class="post-meta__tags" href="/tags/SQL/">SQL</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/05/12/%E6%95%B0%E6%8D%AE%E5%BA%93-MySQL-5/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL SQL 存储过程（六）</div></div></a></div><div class="next-post pull-right"><a href="/2019/05/11/Java-%E6%97%A5%E5%BF%97-5/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/okfOw28KlZFbE7z.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">日志框架--logback</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2019/05/16/数据库-MySQL-10-0/" title="MySQL SQL 权限(八)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-11-28</div><div class="title">MySQL SQL 权限(八)</div></div></a></div><div><a href="/2019/05/17/数据库-MySQL-11-2/" title="MySQL SQL 备份--xtrabackup (九)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-11-06</div><div class="title">MySQL SQL 备份--xtrabackup (九)</div></div></a></div><div><a href="/2019/05/17/数据库-MySQL-11-1/" title="MySQL SQL 备份--MySQL 工具(九)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/HjVAdIuT7bZJypS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-10-29</div><div class="title">MySQL SQL 备份--MySQL 工具(九)</div></div></a></div><div><a href="/2019/05/18/数据库-MySQL-10-2/" title="MySQL SQL 事务(九)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-11-28</div><div class="title">MySQL SQL 事务(九)</div></div></a></div><div><a href="/2019/05/12/数据库-MySQL-5/" title="MySQL SQL 存储过程（六）"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2020-03-19</div><div class="title">MySQL SQL 存储过程（六）</div></div></a></div><div><a href="/2019/05/14/数据库-MySQL-6/" title="MySQL SQL 触发器和索引(七)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/PFDRNxj93taz6pw.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2019-05-22</div><div class="title">MySQL SQL 触发器和索引(七)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://s2.ax1x.com/2020/02/11/1ovw6J.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">平心</div><div class="author-info__description">年轻人的life、learn and think</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">449</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">77</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">68</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hanyunpeng0521"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hanyunpeng0521" target="_blank" title="Github"><i class="fa fa-github"></i></a><a class="social-icon" href="mailto:m13839441583@163.com" target="_blank" title="Email"><i class="fa fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title=""><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">为什么呢？开始提问吧</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">常用函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">数学函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">聚集函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.</span> <span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.</span> <span class="toc-text">日期和时间函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.</span> <span class="toc-text">加密解密函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.</span> <span class="toc-text">格式化函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">1.7.</span> <span class="toc-text">类型转换函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.</span> <span class="toc-text">系统信息函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.</span> <span class="toc-text">排名函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0UDF"><span class="toc-number">2.</span> <span class="toc-text">自定义函数UDF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">语法</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/05/15/node-2-4/" title="Egg.js -- 为企业级框架和应用而生"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/okfOw28KlZFbE7z.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Egg.js -- 为企业级框架和应用而生"/></a><div class="content"><a class="title" href="/2021/05/15/node-2-4/" title="Egg.js -- 为企业级框架和应用而生">Egg.js -- 为企业级框架和应用而生</a><time datetime="2021-05-15T10:18:59.000Z" title="发表于 2021-05-15 18:18:59">2021-05-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/30/node-2-3/" title="Koa -- 基于Node.js平台的下一代Web开发框架"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/HjVAdIuT7bZJypS.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Koa -- 基于Node.js平台的下一代Web开发框架"/></a><div class="content"><a class="title" href="/2021/04/30/node-2-3/" title="Koa -- 基于Node.js平台的下一代Web开发框架">Koa -- 基于Node.js平台的下一代Web开发框架</a><time datetime="2021-04-30T10:18:59.000Z" title="发表于 2021-04-30 18:18:59">2021-04-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/01/node-2-1/" title="Node.JS web开发前置知识"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Node.JS web开发前置知识"/></a><div class="content"><a class="title" href="/2021/04/01/node-2-1/" title="Node.JS web开发前置知识">Node.JS web开发前置知识</a><time datetime="2021-04-01T03:18:59.000Z" title="发表于 2021-04-01 11:18:59">2021-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-1/" title="第十一周--谷歌浏览器插件"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第十一周--谷歌浏览器插件"/></a><div class="content"><a class="title" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-1/" title="第十一周--谷歌浏览器插件">第十一周--谷歌浏览器插件</a><time datetime="2020-12-26T10:18:59.000Z" title="发表于 2020-12-26 18:18:59">2020-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-0/" title="第十一周--浏览器技术"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/vCnKyoFJZ1g4XYR.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第十一周--浏览器技术"/></a><div class="content"><a class="title" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-0/" title="第十一周--浏览器技术">第十一周--浏览器技术</a><time datetime="2020-12-26T06:18:59.000Z" title="发表于 2020-12-26 14:18:59">2020-12-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 平心</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '4lfIXzqxaC1ONs0MJO4oHu07-gzGzoHsz',
      appKey: 'qw99Bw8FD0KVKU9m457CwWsr',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>