---
title: 第六周--serverless
date: 2019-12-19 18:18:59
tags:
 - 周记
categories:
 - 周记
---

#### 本周速记

**方法论**

本周来学习一下网站新技术

1. servlet 4
2. http 2与http 3 
3. serverless
4. SSL\TLS

<!--more-->

### serverless

容器技术是这几年IT界的热门话题，各行各业都在研究如何通过容器提升企业软件开发、交付和管理的效率。

Docker和Kubernetes的成功使得仅凭几个人也可以轻易管理一个包含上千台机器的庞大的计算集群，并且在这个庞大的集群上部署各种各样的应用。云计算催生了容器技术，而容器技术也改变了云计算

容器技术的应用可谓百花齐放，范围涉及微服务、DevOps到最近的人工智能和深度学习

过去十多年的云计算的历程，其实是一个“去基础架构”的过程。这个过程让用户可以更快速、更简单、更高效地将想法变成应用，变成在线的服务

Serverless符合云计算发展的方向，让用户可以将关注点放到具体的业务功能上，而不是底层的计算资源上。Serverless特有的模式存在着潜在的巨大价值。那么，Serverless会取代容器吗？我相信不会。虽然Serverless架构在一些特定的领域会大放异彩，但是容器在未来仍然会是一种重要的应用分发和部署格式。此外容器也将成为许多Serverless平台的基础技术，成为Serverless实现的基石

虽然Serverless架构在一些特定的领域会大放异彩，但是容器在未来仍然会是一种重要的应用分发和部署格式。此外容器也将成为许多Serverless平台的基础技术，成为Serverless实现的基石

Serverless架构即“无服务器”架构，它是一种全新的架构方式，是云计算时代一种革命性的架构模式

**Serverless应用满足了云原生应用的定义，充分利用了云平台的各种能力，极大地提高了应用开发、交付和运维的效率。因此，Serverless应用是原生应用的一种实现，Serverless架构是用户通向云原生应用的道路之一**

#### 什么是Serverless

技术圈中的人们一般称呼Serverless为“无服务器架构”。Serverless不是具体的一个编程框架、类库或者工具。简单来说，Serverless是一种软件系统架构思想和方法，它的核心思想是用户无须关注支撑应用服务运行的底层主机。这种架构的思想和方法将对未来软件应用的设计、开发和运营产生深远的影响。

所谓“无服务器”，并不是说基于Serverless架构的软件应用不需要服务器就可以运行，其指的是用户无须关心软件应用运行涉及的底层服务器的状态、资源（比如CPU、内存、磁盘及网络）及数量。软件应用正常运行所需要的计算资源由底层的云计算平台动态提供。

Serverless与传统架构区别

- 在传统的场景里，当用户完成了应用开发后，软件应用将被部署到指定的运行环境，用户会申请一定数量、一定规格（包含一定数量的CPU、内存及存储空间）的服务器以满足该应用的正常运行。当应用上线后，根据实际的运营情况，用户可能会申请更多的服务器资源进行扩容，以应对更高的访问量
- 在Serverless架构下，情况则截然不同。当用户完成应用开发后，软件应用将被部署到指定的运行环境，这个运行环境不再是具体的一台或多台服务器，而是支持Serverless的云计算平台。有客户端请求到达或特定事件发生时，云计算平台负责将应用部署到某台Serverless云计算平台的主机中。Serverless云计算平台保证该主机提供应用正常运行所需的计算资源。在访问量升高时，云计算平台动态地增加应用的部署实例。当应用空闲一段时间后，云计算平台自动将应用从主机中卸载，并回收资源

结论

- 在Serverless架构中并不是不存在服务器，而是服务器对用户而言是透明的，不再是用户所操心的资源对象
- Serverless的实现和软件应用所在的Serverless云计算平台有着很大的关系。用户之所以不用再关注服务器是因为底层的云计算平台完成了大量的自动化工作。这个云计算平台可以是公有云，如Amazon Web Services（AWS）、Microsoft Azure、阿里云或腾讯云，也可以是私有云，如通过OpenStack、Kubernetes结合一些Serverless框架实现

**价值**

一项技术被广泛认可和采纳的原因往往不是因为这项技术有多新鲜或多酷，最重要的推动力是其能为业务带来巨大的商业或经济价值

1. 降低运营复杂度

   Serverless架构使软件应用和服务器实现了解耦，服务器不再是用户开发和运营应用的焦点。在应用上线前，用户无须再提前规划服务器的数量和规格。在运维过程中，用户无须再持续监控和维护具体服务器的状态，只需要关心应用的整体状态

2. 降低运营成本

   Serverless的应用是按需执行的。应用只在有请求需要处理或者事件触发时才会被加载运行，在空闲状态下Serverless架构的应用本身并不占用计算资源

   在Serverless架构下，用户只需要为处理请求的计算资源付费，而无须为应用空闲时段的资源占用付费。这个特点将为大规模使用公有云服务的用户节省一笔可观的开销

3. 缩短产品的上市时间

   在Serverless架构下，应用的功能被解构成若干个细颗粒度的无状态函数，功能与功能之间的边界变得更加清晰，功能模块之间的耦合度大大减小。这使得软件应用的开发效率更高，应用开发的迭代周期更短

   Serverless架构应用的上市时间（Time To Market，TTM）将大大减少

4. 增强创新能力

   应用的开发和部署效率的提升，使得用户可以用更短的时间、更少的投入尝试新的想法和创意

**实现**

首先要明确的一点是，Serverless是一种软件的架构理念。它的核心思想是让作为计算资源的服务器不再成为用户所关注的一种资源。其目的是提高应用交付的效率，降低应用运营的工作量和成本。但是，要实现Serverless架构的落地，需要一些实实在在的工具和框架作为有力的技术支撑和基础

目前比较流行的Serverless工具、框架和平台

- AWS Lambda，最早被大众所认可的Serverless实现
- Azure Functions，来自微软公有云的Serverless实现
- OpenWhisk，Apache社区的开源Serverless框架
- Kubeless，基于Kubernetes架构实现的开源Serverless框架
- Fission，Platform9推出的开源Serverless框架
- OpenFaaS，以容器技术为核心的开源Serverless框架
- Fn，来自Oracle的开源Serverless框架，由原Iron Functions团队开发。

**FaaS与BaaS**

目前业界的各类Serverless实现按功能而言，主要为应用服务提供了两个方面的支持：函数即服务（Function as a Service，FaaS）以及后台即服务（Backend as a Service，BaaS）。

1. FaaS

   FaaS提供了一个计算平台，在这个平台上，应用以一个或多个函数的形式开发、运行和管理。

   FaaS可以根据实际的访问量进行应用的自动化动态加载和资源的自动化动态分配。大多数FaaS平台基于事件驱动（Event Driven）的思想，可以根据预定义的事件触发指定的函数应用逻辑

   ![Q7Iwwj.png](https://s2.ax1x.com/2019/12/18/Q7Iwwj.png)

   FaaS是目前Serverless架构实现的一个重要手段。FaaS平台的特点在很大程度上影响了目前Serverless应用的架构和实现方式。因此，有一部分人认为FaaS等同于Serverless，

   目前业界主流的观点是Serverless和FaaS并不是等同关系，FaaS平台是一个完整的Serverless实现的重要组成部分，仅仅通过FaaS平台并不能完全实现Serverless架构的落地。

   FaaS为应用的开发、运行和管理提供良好的Serverless基础。但是对应用整体系统而言，并没有完全实现Serverless化。因此，在实现应用架构Serverless化时，也应该实现应用所依赖的服务的Serverless化。

2. BaaS

   为了实现应用后台服务的Serverless化，BaaS（后台即服务）也应该被纳入一个完整的Serverless实现的范畴内。

   BaaS涵盖的范围很广泛，包含任何应用所依赖的服务。AWS的DynamoDB数据库就是DBaaS的一个例子。用户按需申请使用数据库服务，而无须关注数据库的运维和缩扩容。数据库的运维完全由服务提供方AWS负责。

   要实现完整的Serverless架构，用户必须结合FaaS和BaaS的功能，使得应用整体的系统架构实现Serverless化，最大化地实现Serverless架构所承诺带来的价值。因此，一个完整的Serverless实现，必须同时提供FaaS和BaaS两个方面的功能。

**应用架构**

下面我们通过一个简单的例子观察Serverless架构下的应用与传统架构下的应用的异同

- 传统架构

  ![Q7Ib6O.png](https://s2.ax1x.com/2019/12/18/Q7Ib6O.png)

  这是一个常见的传统应用设计和部署架构

- Serverless应用架构

  Serverless架构下的应用架构图。这个应用实现的功能和前文的应用一样，即为用户提供订单的增删查改服务。应用被部署在Serverless平台之上。应用的功能点变成若干个函数定义，部署于FaaS之中。

  ![Q7IX0H.png](https://s2.ax1x.com/2019/12/18/Q7IX0H.png)

两种架构的比较

1. 传统架构的应用部署在主机之上，而Serverless架构的应用部署于Serverless平台之上，由Serverless平台提供运行所需的计算资源
2. 传统架构的应用里，所有的逻辑都集中在同一个部署交付件中。Serverless应用的逻辑层部署运行在Serverless平台的FaaS服务之上。因此，应用的逻辑被打散成多个独立的细颗粒度的函数逻辑。因为业务逻辑运行在FaaS服务之上，所以相关的业务逻辑拥有事件驱动、资源自动弹性扩展、高可用等特性。用户也无须运维业务逻辑所消耗的计算资源
3. Serverless架构的应用所依赖的数据库从具体的特定数据库实例，变成了数据库服务。用户无须关注数据库所消耗的计算资源的运维
4. 在Serverless架构下，由于应用的逻辑分散成了若干个函数，推荐通过API网关对这些函数逻辑进行统一的管控（如流量控制、安全管控、版本管理等）。在完备的Serverless平台上，API网关也会作为一种用户可以快速消费的服务而存在
5. 在Serverless架构下，具体的主机资源不再是用户关注的对象，不存于应用架构图中。取而代之的是Serverless平台及其子服务，如FaaS和各类BaaS服务。

**技术特点**

1. 按需加载

   在Serverless架构下，应用的加载（load）和卸载（unload）由Serverless云计算平台控制。这意味着应用不总是一直在线的。只有当有请求到达或者有事件发生时才会被部署和启动。

2. 事件驱动

   Serverless架构的应用并不总是一直在线，而是按需加载执行。

   通过将不同事件来源（Event Source）的事件（Event）与特定的函数进行关联，实现对不同事件采取不同的反应动作，这样可以非常容易地实现事件驱动（Event Driven）架构。

3. 状态非本地持久化

   应用不再与特定的服务器关联。因此应用的状态不能，也不会保存在其运行的服务器之上，

4. 非会话保持

   应用不再与特定的服务器关联。每次处理请求的应用实例可能是相同服务器上的应用实例，也可能是新生成的服务器上的应用实例。因此，Serverless架构更适合无状态的应用。

5. 自动弹性伸缩

   Serverless应用原生可以支持高可用，可以应对突发的高访问量。应用实例数量根据实际的访问量由云计算平台进行弹性的自动扩展或收缩，云

6. 应用函数化

   Serverless架构下的应用会被函数化，但不能说Serverless就是Function as a Service（FaaS）。

7. 依赖服务化

   在Server-less架构下的应用的依赖应该服务化和无服务器化，也就是实现Backend as a Service（BaaS）。所有应用依赖的服务都是一个个后台服务（Backend Service），应用通过BaaS方便获取，而无须关心底层细节。和FaaS一样，BaaS是Serverless架构实现的另一个重要组件。

**应用场景**

1. Web应用

   Serverless架构可以很好地支持各类静态和动态Web应用。

   通过FaaS的自动弹性扩展功能，Serverless Web应用可以很快速地构建出能承载高访问量的站点。

   举一个有意思的例子，为了应对每5年一次的人口普查，澳大利亚政府耗资近1000万美元构建了一套在线普查系统。但是由于访问量过大，这个系统不堪重负而崩溃了。在一次编程比赛中，两个澳大利亚的大学生用了两天的时间和不到500美元的成本在公有云上构建了一套类似的系统。在压力测试中，这两个大学生的系统顶住了类似的压力。

2. 移动互联网

   Serverless应用通过BaaS对接后端不同的服务而满足业务需求，提高应用开发的效率。

   开发者可以通过函数快速地实现业务逻辑，而无须耗费时间和精力开发整个服务端应用。

3. 物联网

   物联网（Internet of Things，IoT）应用需要对接各种不同的数量庞大的设备。不同的设备需要持续采集并传送数据至服务端。Serverless架构可以帮助物联网应用对接不同的数据输入源。
   多媒体处理

   视频和图片网站需要对用户上传的图片和视频信息进行加工和转换。但是这种多媒体转换的工作并不是无时无刻都在进行的，只有在一些特定事件发生时才需要被执行，比如用户上传或编辑图片和视频时。通过Serverless的事件驱动机制，用户可以在特定事件发生时触发处理逻辑，从而节省了空闲时段计算资源的开销，

4. 数据及事件流处理

   Serverless可以用于对一些持续不断的事件流和数据流进行实时分析和处理，对事件和数据进行实时的过滤、转换和分析，进而触发下一步的处理。比如，对各类系统的日志或社交媒体信息进行实时分析，针对符合特定特征的关键信息进行记录和告警。

5. 系统集成

   Serverless应用的函数式架构非常适合用于实现系统集成。用户无须像过去一样为了某些简单的集成逻辑而开发和运维一个完整的应用，用户可以更专注于所需的集成逻辑，只编写和集成相关的代码逻辑，而不是一个完整的应用。

**局限**

1. 控制力

   对于一些希望掌控底层计算资源的应用场景，Serverless架构并不是最合适的选择。

2. 可移植性

   Serverless应用的实现在很大程度上依赖于Serverless平台及该平台上的FaaS和BaaS服务。不同IT厂商的Serverless平台和解决方案的具体实现并不相同。

3. 安全性

   Serverless架构下，用户不能直接控制应用实际所运行的主机。不同用户的应用，或者同一用户的不同应用在运行时可能共用底层的主机资源。对于一些安全性要求较高的应用，这将带来潜在的安全风险

4. 性能

   应用的首次加载及重新加载的过程将产生一定的延时。对于一些对延时敏感的应用，需要通过预先加载或延长空闲超时时间等手段进行处理。

5. 执行时长

   大部分Serverless平台对FaaS函数的执行时长存在限制。因此Serverless应用更适合一些执行时长较短的作业。

6. 技术成熟度

   目前Serverless相关平台、工具和框架还处在一个不断变化和演进的阶段，开发和调试的用户体验还需要进一步提升。Serverless相关的文档和资料相对比较少，深入了解Serverless架构的架构师、开发人员和运维人员也相对较少

#### 云计算发展看Serverless

首先，抛一个总结性观点：云计算的发展从IaaS，PaaS，SaaS，到最新的BaaS，FasS，在这个趋势中serverless(去服务器化）越来越明显，而Serveless的完善带给云计算将会是一次完美进化！

![Q76LIU.png](https://s2.ax1x.com/2019/12/18/Q76LIU.png)

##### 从私有数据中心到云

按所管控的计算资源的范围来划分，云计算模式可以分为基础架构即服务（Infrastructure as a Service）、平台即服务（Platform as a Service，PaaS）以及软件即服务（Software as a Service，SaaS）。

在云计算传统的私有数据中心架构中，让一个应用服务上线跑起来，用户需要负责管理和维护底层网络、存储和主机，到操作系统、中间件，以及应用的开发、部署及运维。

在传统的架构模式中，每上线一个应用服务，都要求用户对架构堆栈中每一个层次的服务进行配置和维护，这极大地拖慢了整体的流程效率，传统的架构限制了生产力的发展，于是云计算的变革悄然而至

##### 云平台

总所周知，云计算经历了从IDC -> IaaS -> PaaS -> Serverless/FaaS 的发展历程，下面对这些概念做一些基本介绍。

1. IaaS

   ![Q7cQdf.png](https://s2.ax1x.com/2019/12/18/Q7cQdf.png)

   IaaS(Infrastructure as a Service) 基础设施即服务，服务商提供底层/物理层基础设施资源（服务器，数据中心，环境控制，电源，服务器机房），用户需要通过IaaS提供的服务平台购买虚拟资源，选择操作系统，安装软件，部署程序，监控应用。

   在IaaS架构中，应用架构底层的网络、存储和计算资源（主机、物理机或虚拟机），由云平台供应商（Cloud Provider）提供和运维。用户在云平台上付费申请所需的网络、存储和计算资源，云平台供应商在一定时间内提供。对于云平台供应商而言，集中化和规模化地运维及供给使得基础架构资源的成本更低

   目前知名的IaaS平台有AWS，Azure，Google Cloud Plantform，阿里云以及开源的OpenStack等。

2. PaaS:以应用为中心

   ![Q7cJzj.png](https://s2.ax1x.com/2019/12/18/Q7cJzj.png)

   PaaS(Platform as a Service) 平台即服务，服务商提供基础设施底层服务，提供操作系统（Windows，Linux）、数据库服务器、Web服务器、负载均衡器和其他中间件，相对于IaaS客户仅仅需要自己控制上层的应用程序部署与应用托管的环境。

   PaaS平台提供了应用的运行环境（如应用运行时）、应用依赖的服务（如数据库、中间件、负载均衡、构建服务、发布服务）以及底层所需的计算资源，用户可以把精力集中在应用的开发和创新上。PaaS模式可以提高应用开发、发布和运维的整体效率，有效缩短了应用上市的时间（Time to Market）

   目前知名的PaaS平台有 Amazon Elastic Beanstalk，Azure，Google App Engine，VMware Cloud Foundry等。

   目前一些主流的PaaS平台和Serverless平台，主要差异在于：

   |              |                             PaaS                             |                          Serverless                          |
   | :----------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
   |  管理颗粒度  |                对应用颗粒度的管理以应用为单位                |                     细致到每个应用的函数                     |
   | 应用部署模式 |           应用是持续地被部署在主机、虚拟主机、容器           | 按需部署，这是Serverless的按用量付费（Pay-As-You-Use）模型的基础 |
   |   作业类型   | 包含长时间运行的应用（如各类Web应用和业务系统）和定时执行的短期任务（如数据分析抽取任务） |                偏向于执行时间跨度比较短的任务                |
   |     实例     | 存在应用实例数这一概念的，用户需要设置每一个实例的CPU和内存的使用大小以及需要的实例数 |                     将实例数的概念移除了                     |

   当前许多PaaS平台也开始支持容器，或是以容器作为技术架构的基础，如Red Hat的OpenShift就是一个以Docker和Kubernetes为基础的开源容器PaaS。基于这种容器PaaS平台，结合FaaS和BaaS框架的支持，用户可以实现私有的Serverless平台

3. SaaS

   SaaS(Software as a Service) 软件即服务， 服务商提供基于软件的解决方案，如OA、CRM、MIS、ERP、HRM、CM、Office 365、iCloud等，客户不需考虑任何形式的专业技术知识，只需要通过服务商平台获取软件使用即可。

   ![Q7cDFU.png](https://s2.ax1x.com/2019/12/18/Q7cDFU.png)

   SaaS模式下，用户完全不用管理任何应用和基础设施，从而变成云服务的消费者

4. BaaS

   BaaS(Backend as a Service) 后端即服务，服务商为客户(开发者)提供整合云后端的服务，如提供文件存储、数据存储、推送服务、身份验证服务等功能，以帮助开发者快速开发应用。

   通过BaaS平台，用户的应用程序可以对接后端的各种服务，省去了用户学习各种技术和中间件的成本，降低了应用开发的复杂度。BaaS的服务往往由服务供应商提供，用户无须关心底层细节，无须维护相关资源

5. FaaS

   FaaS(Function as a Service) 函数即服务，服务商提供一个平台，允许客户开发、运行和管理应用程序功能，而无需构建和维护基础架构。 按照此模型构建应用程序是实现“无服务器”体系结构的一种方式，通常在构建微服务应用程序时使用。

   因为FaaS和Serverless的关系密切，因此FaaS的特点同时也是Serverless平台的特点：

   - 抽象了底层计算资源
   - 按使用量付费
   - 自动弹性扩展
   - 事件驱动

   FaaS是当前Serverless实现的重要基础，所以有一部分人认为Serverless就是FaaS。这是狭义上的Serverless。

**IaaS，PaaS，FaaS 对比**

举个例子，比如小明想开一个水果店

IDC：如果盖房子，装修，然后上架水果这些工作都是小明自己来做。

IaaS：如果小明房子是租的，装修，上架水果是自己做。

PaaS: 如果小明房子是租的，可是房子已经装修好了，但是上架水果要自己来做。

FaaS：如果有一个商家提供装修好的水果店，小明只负责把水果送过来，其余上架工作都由商家来做。

**总结**

从IDC → IaaS，用户不用关注真实的物理资源。

从IaaS → PaaS，用户不再关注操作系统，数据库，中间件等基础软件。

从PaaS → BaaS/FaaS, 用户可以很少甚至不用关注backend，app可以简化为一个单页面程序。

**可以说，Serverless是云计算发展到一定阶段的必然产物，云计算作为普惠科技，发展到最后一定是绿色科技（最大程度利用资源，减少空闲资源浪费），大众科技（成本低，包括学习成本及使用成本）的产品，而Serverless将很好的诠释这些！**

**Serverless与云计算**

1. Serverless是云计算变革过程中的一个必然产物。Serverless架构实现的一个重要基础是函数即服务（Function as a Service，FaaS）。
2. FaaS的灵活度和管理成本介于PaaS和SaaS之间。相对于PaaS而言，FaaS有更高的抽象程度和更低的管理成本。相对于SaaS来说，FaaS用户有更高的控制力和灵活度。Serverless架构是对开发和运维的一场解放运动，让用户的焦点回到用户应该关注的地方
3. 云计算的不断发展是Serverless发展和流行的最大推动因素。Serverless是云计算未来发展的一个方向

##### 微服务

**从SOA到微服务**

在SOA架构下，应用通过服务暴露功能，实现了彼此信息的交换和集成，使得通过服务的组合和编排形成新的应用系统成为可能。但是多个模块和功能仍然被包含在同一个应用中、同一个交付件中

微服务架构（Microservice Architecture，MSA）提倡将应用化整为零，减小颗粒度

大型的应用（Monolithic Application）按照一定的规则被拆分成若干个颗粒度更小的应用。这些细小的应用称为微服务（Microservice）

**价值与挑战**

微服务增加了应用架构的灵活度，为应用的开发和交付带来了价值

- 更清晰的权责

- 更快速的开发和交付节奏

- 更灵活的资源扩展

微服务架构在带来价值的同时也带来了一些新的挑战

- 团队组织变化：应用架构的改变也将导致开发应用的开发团队结构发生变化
- 运维复杂度：运维管理的应用实例数将大大增加。微服务架构下工作量呈指数级增长。
- 微服务治理：微服务之间的通信、调用链的跟踪管理、状态监控、错误跟踪排查等都需要相应的解决方案

**Serverless与微服务**

|          |                          微服务                          |                          Serverless                          |
| :------: | :------------------------------------------------------: | :----------------------------------------------------------: |
| 功能结构 |                   最小成员单位是微服务                   |                      最小成员单位是函数                      |
|   强调   |               化整为零，提高应用架构灵活度               | 强调的是“减负”，将服务器移出用户的管理职责范围，降低复杂度和成本 |
|   成本   | 架构上带来灵活性的同时，也增加了开发、部署和运维的复杂度 |              开发和运维的效率更高，管理成本更低              |

##### 容器

对于很多用户而言，云和非云环境并不是二选一，而是两者都需要。云和非云环境在相当长的一段时间内将同时存在。应用如何快速地在云和非云环境中迁移成为一个重要的问题。为了有更高的可用性，避免厂商的锁定，一些实力雄厚的客户往往同时是多家云平台供应商的客户。因此实现应用在不同云环境中的快速迁移也成为一个重要的需求

容器（Container）技术的出现为前文提及的问题提供了一个很好的解决方案。经过几年的迅速发展，容器已经不容置疑地成为云计算的一项关键基础技术。Docker（现在已经更名为Moby项目）已成为容器引擎的事实标准。Kubernetes也在竞争中脱颖而出，成为容器编排（Orchestration）平台的事实标准。通过Kubernetes这样的容器编排平台，容器镜像可以快速地被部署到成百上千的主机上。Kubernetes成为一种类似操作系统的存在，有的人认为Kubernetes就是一种云操作系统。传统的操作系统只管理一台主机上的CPU、内存、磁盘和网络资源，而Kubernetes则掌控着数据中心中成百上千台主机的资源。

**Serverless与容器**

1. 容器架构中最小的运行单元是容器，而Serverless中则是函数。容器应用一般是预先部署，然后持续在线。而在Serverless架构中，应用是按需加载和执行的。这意味着理论上Serverless的资源使用效率更高。
2. 其实，容器技术可以是Serverless架构实现的一个基础。容器平台的最小运行单元为容器，虽然目前容器内一般运行的是一个完整的应用，但是将容器内运行的对象变成函数显然并无技术困难。Kubernetes上默认没有事件触发的支持，无法做到按需部署容器应用。但是通过Kubernetes叠加上一些FaaS框架运行包含函数逻辑的容器，用户很容易使Kubernetes具备FaaS服务的能力，容器必将是未来私有云构建Serverless能力的一个重要实现基础。

##### FaaS的架构

FaaS是当前Serverless实现的重要基础，所以有一部分人认为Serverless就是FaaS。这是狭义上的Serverless。

目前，业界有多种FaaS的实现方案，如公有云的AWS Lambda、Microsoft Azure Fun-ctions、Google Cloud Functions，私有云的OpenWhisk、Fn、Kubeless等。

宏观来看，一个FaaS平台的架构中包含如下主要组件：

- 函数定义（Function Definition）：一个函数实现一个业务逻辑
- 函数实例（Function Instance）：在运行状态的应用函数的实例
- 控制器（Controller）：负责应用函数的加载、执行等流程的管理
- 事件（Event）：事件驱动架构中的事件
- 事件源（Event Source）：事件驱动架构中的事件来源。可以是一个数据库中插入了新的记录，也可以是一个目录里删除了一个文件，或者是消息队列收到了新的消息
- 触发规则（Trigger Rule）：定义事件与函数的关系及触发的规则
- 平台服务（Platform Service）：支撑应用运行的各类底层服务，如计算资源、数据存储等

**函数的生命周期**

在FaaS上一个函数从创建到执行的生命周期

- 用户根据所选定的FaaS平台的规范进行函数应用的开发。
- 编写好的函数将上传至FaaS平台。平台将负责编译和构建这些函数，并将构建的输出保存。
- 用户设置函数被触发的规则，将事件源与特定版本的函数进行关联。
- 当事件到达且满足触发规则时，平台将会部署、编译构建后的函数并执行。平台将监控函数执行的状态，根据请求量的大小，平台负责对函数实例进行扩容和缩容

**函数工作流**

当涉及多个函数执行时，就需要有逻辑处理执行的顺序、错误重试、异常捕获以及状态传递等细节。

一些FaaS实现开始提供针对FaaS函数的流程编排服务或工具，以简化FaaS应用的流程编排，如AWS Step Functions和Fission Workflows

##### 广义的Serverless

**广义的Serverless包含FaaS和BaaS两个方面**。FaaS解决了应用本身的“无服务器”化，BaaS解决了应用依赖的第三方服务的“无服务器”化。当应用和其依赖的服务都实现了“无服务器”化时，这个应用才算是完整的Serverless应用。

##### NoOps

NoOps，中文直译为“无运维”，或许翻译为“无人运维”更为合适。知名的市场调研公司Forrester于2011年发表的报告《Augment DevOps With NoOps》中提出了NoOps这一概念。它们认为随着云计算的不断演进、IT自动化程度的不断完善、IT自服务程度的不断提高以及应用架构的自扩展和自恢复的实现，IT将进入无须人工运维的阶段

**“无服务器”与“无人运维”**

NoOps和Serverless都存在“无”的概念。在Serverless架构下，运维人员不再需要关注底层的基础架构，但是还是需要有人对应用的整体运营状态进行维护。运维关注的焦点会从以往的基础架构转移到云服务和应用的运维上。运维人员有更多的时间关注对业务更有价值的地方，如服务的用户体验，而非系统宕机时间

##### DevOps

DevOps是一种IT的治理理念，这种理念强调和谐的开发（Develop）和运维（Operation）的协作，以便为IT提供更可靠和更高质量的交付，从而提升IT的效率和对业务的响应速度。DevOps不仅仅是简单的工具，它还涉及一个企业或组织的文化和流程。

Serverless架构极大地改变了应用开发、部署和运营的模式，对软件的开发、测试与运维人员的协助模式和关系产生巨大的影响。DevOps所倡导的协作、分享和精益的文化对Serverless的推行而言有着很大益处。

##### 云原生应用

1. 因云而生

   云将会是主流的应用运行平台，是应用的标准运行环境。所谓的云原生应用（Cloud Native Application）是指充分利用云平台的各种功能和服务所设计的应用程序。未来的应用要充分利用云上的各种设施和功能，最大限度地加速应用的开发、部署和运营，使云的价值最大化

   云平台是云原生应用的运行基础环境。微服务为云原生应用提供了架构层面的指导思想。容器将会是云原生应用的一种重要交付格式，保证了云原生应用的可移植性。DevOps为云原生应用的开发、交付和运营提供了思想层面的指导

2. Serverless与Cloud Native

   Serverless应用满足了云原生应用的定义，充分利用了云平台的各种能力，极大地提高了应用开发、交付和运维的效率。因此，**Serverless应用是原生应用的一种实现**，Serverless架构是用户通向云原生应用的道路之一

   云原生计算基金会（Cloud Native Computing Foundation，CNCF）是一个专注于推广和标准化云原生技术的组织，目前成员超过100个，包括Google、Amazon、微软、阿里巴巴、华为、Red Hat、Cisco、IBM、Oracle等。云计算领域中许多备受关注的前沿项目都归属于CNCF，如容器编排平台Kubernetes、日志收集器Fluentd、高性能远程调用协议gRPC以及性能指标收集方案Prometheus等。Serverless的流行也受到了CNCF的高度关注，CNCF在2018年发布了Serverless白皮书，探讨了Serverless在云原生计算中的价值以及CNCF在Serverless领域的未来动向

##### 小结

要完整认识一个事物，除研究这个事物本身之外，还要了解其所在的生态系统。Serverless是云计算变革的一个产物，是构建云原生应用的一种模式和思想。通过这种思想，结合云计算相关技术，用户可以用更低的成本构建更高性能、更易于扩展及更高可用的云应用

#### Serverless资源分类

1. Serverless平台：提供Serverless应用开发和运维的公有云和私有云平台，如AWS Lambda、Azure Functions、Google Cloud Functions等公有云平台；OpenWhisk、Fission、Kubeless、Fn、OpenFaaS等都可以被部署在私有数据中心的开源Serverless平台。
2. Serverless框架：Serverless平台为用户提供了开发和运行Serverless的基础，但是许多Serverless平台应用开发的用户体验还不是很完善。为了方便用户同时在多个不同平台上开发和部署应用，业界出现了一批Serverless框架，以帮助用户降低Serverless应用开发、部署和管理的复杂度，提高效率。比如，一款名为Serverless Framework的框架同时支持AWS、Azure、Google及OpenWhisk等众多平台。
3. Serverless工具：各类Serverless应用的辅助工具，简化Serverless应用设计和部署的.architect。如，帮助用户监控管理Serverless应用的日志和性能的Dashbird和IO Pipe，帮助用户对Serverless应用进行持续集成的LambCI。
4. 编程语言库：针对某种编程语言的Serverless类库。python-λ是一款基于Python语言的Serverless工具，可以简化基于Python的AWS Lambda应用的开发和部署。
5. 后台服务：完整的Serverless应用往往还依赖于第三方的后台服务，以解决安全、数据持久化、消息传递等需求。如安全服务Puresec，为Serverless应用提供安全运行环境（Serverless Security Runtime Environment，SSRE）；Snyk提供Serverless应用的安全漏洞扫描服务。

具体实现技术工具参考:https://www.jianshu.com/p/0a6c4963c8ba

### 参考

1. [当我们聊Serverless时你应该知道这些](https://yq.aliyun.com/articles/574222)
2. [serverless](https://www.jianshu.com/p/92632d6c2269)
3. [有了 serverless，前端也可以快速开发一个 Puppeteer 网页截图服务](https://zhuanlan.zhihu.com/p/97117333)
4. [云原生基础及调研](https://zhuanlan.zhihu.com/p/96077452)
5. [深入浅出Serverless](https://www.jianshu.com/nb/38787015)
6. [架构思考：Microservice与Serverless的优劣势比较](https://blog.csdn.net/wucong60/article/details/83616744)