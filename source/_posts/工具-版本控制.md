---
title: 浅析版本控制
date: 2019-03-18 07:18:59
tags:
 - 工具
 - 版本控制
categories:
 - 工具
 - 版本控制
---

### 前言

版本控制是指对软件开发过程中各种程序代码、配置文件及说明文档等文件变更的管理，是软件配置管理的核心思想之一。

版本控制最主要的功能就是追踪文件的变更。它将什么时候、什么人更改了文件的什么内容等信息忠实地了已录下来。每一次文件的改变，文件的版本号都将增加。这种方法是工程图（engineering drawings）维护（maintenance）的标准做法， 它伴随着工程图从图的诞生一直到图的定型。 一种简单的版本控制形式，例如，赋给图的初版一个版本等级“A”。当做了第一次改变后，版本等级改为“B”，以此类推等等。

<!--more-->

![](https://ws1.sinaimg.cn/large/006KyevZgy1g16rfh3pzuj30hs09bq3e.jpg)

除了记录版本变更外，版本控制的另一个重要功能是并行开发。软件开发往往是多人协同作业，版本控制可以有效地解决版本的同步以及不同开发者之间的开发通信问题，提高协同开发的效率。并行开发中最常见的不同版本软件的错误(Bug)修正问题也可以通过版本控制中分支与合并的方法有效地解决。

### 功能

版本控制是软件配置管理的核心功能。所有置于配置库中的元素都应自动予以版本的标识，并保证版本命名的唯一性。版本在生成过程中，自动依照设定的使用模型自动分支、演进。除了系统自动记录的版本信息以外，为了配合软件开发流程的各个阶段。还需要定义、收集一些元数据来记录版本的辅助信息和规范开发流程，并为今后对软件过程的度量做好准备。

当然如果选用的工具支持，这些辅助数据将能直接统计出过程数据，从而方便软件过程改进活动的进行。对于配置库中的各个基线控制项，应该根据其基线的位置和状态来设置相应的访问权限。一般来说，对于基线版本之前的各个版本都应处于被锁定的状态，如需要对它们进行变更，则应按照变更控制的流程来进行操作。

版本控制包括：检入检出控制、分支和合并、历史记录。

1. 检入检出控制。同步控制的实质是版本的检入检出控制。检入就是把软件配置项从用户的工作环境存入到软件配置库的过程，检出就是把软件配置项从软件配置库中取出的过程。检人是检出的逆过程。同步控制可用来确保由不同的人并发执行的修改不会产生混乱。
2. 分支和合并。版本分支(以一个已有分支的特定版本为起点，但是独立发展的版本序列)的人工方法就是从主版本——称为主干上拷贝一份，并做上标记。在实行了版本控制后，版本的分支也是一份拷贝，这时的拷贝过程和标记动作由版本控制系统完成。版本合并(来自不同分支的两个版本合并为其中一个分支的新版本)有两种途径，一是将版本A的内容附加到版本B中；另一种是合并版本A和版本B的内容，形成新的版本C。
3. 历史记录。版本的历史记录有助于对软件配置项进行审核，有助于追踪问题的来源。历史记录包括版本号、版本修改时间、版本修改者、版本修改描述等最基本的内容，还可以有其他一些辅助性内容，比如版本的文件大小和读写属性。

### 特征

1. 软件系统的版本控制是指可以自行运行的各子系统的版本控制。

2. 软件系统的版本号由评测小组的人员确定，由评测小组进行版本控制工作。

3. 软件系统的版本号由3部分构成，即主版本号+次版本号+修改号。主版本号1位，只有当系统在结构和功能上有重大突破改进后才发生变化；次版本号有2位；修改号8位，采用提交时的日期，当系统进行任何修改后，包括数据库结构发生变化，修改号都要随之改变。例如：Ver3.31.19990317

4. 各子系统的版本号独立。

5. 各软件系统应该有显示详细版本号的功能。例如help菜单下的about功能。系统提交存档时，评测服务部要进行版本号检查。

6. 新系统开发完成、或已存档的系统进行修改，修改完成后，进行提交存档时，由评测评测小组系统分析工程师确定新版本号、或更改版本号。

7. 软件系统，产生新的版本后，老版本的软件系统是否继续保存，取决于以下条件：

   a. 老版本的系统如果有客户还在使用，在客户升级以前，必须继续保存。

   b.老版本的系统已经没有客户使用了，并且新版本的系统已经把老系统的文档完整地升级过来，这样可以删除或覆盖老版本的系统资源。

   c.对于要删除或覆盖的老版本系统，可以统一备份起来。

### 流程

版本控制基本流程如下：

(1)创建配置项。

项目成员依据《配置管理计划》，在配置库中创建属于其任务范围内的配置项。此时配置项的状态为“草稿”，其版本号格式为0.YZ。

(2)修改状态为“草稿”的配置项目。

项目成员使用配置管理软件的Check in/check out功能，可以自由修改处于“草稿”状态的配置项，版本号格式为0.YZ。

(3)技术评审或领导审批。

如果配置项是技术文档，则需要接受技术评审。如果配置项是“计划”这类文件，则需要项目经理(或上级领导)的审批。若配置项通过了技术评审或领导审批，则转向下一步·否则转回上一步。

(4)正式发布。

配置项通过技术评审或领导审批之后。则配置项的状态从“草稿”变为“正式发布”，版本号格式为X.Y。

(5)变更。

修改处于“正式发布”状态的配置项，必须按照“变更控制流程”执行。

### 分类

#### 本地版本控制系统

许多人习惯用复制整个项目目录的方式来保存不同的版本，或许还会改名加上备份时间以示区别。这么做唯一的好处就是简单。不过坏处也不少：有时候会混淆所在的工作目录，一旦弄错文件丢了数据就没法撤销恢复。

为了解决这个问题，人们很久以前就开发了许多种本地版本控制系统，大多都是采用某种简单的数据库来记录文件的历次更新差异。

![](https://ws1.sinaimg.cn/large/006KyevZly1g16sc3glyhj30b409cjrb.jpg)

#### 集中化的版本控制

接下来人们又遇到一个问题，如何让在不同系统上的开发者协同工作？于是，集中化的版本控制系统（ Centralized Version Control Systems，简称 CVCS ）应运而生。这类系统，诸如 CVS，Subversion 以及 Perforce 等，都有一个单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新。多年以来，这已成为版本控制系统的标准做法。

![](https://ws1.sinaimg.cn/large/006KyevZly1g16sc3sfzhj30dw0awwem.jpg)

这种做法带来了许多好处，特别是相较于老式的本地 VCS 来说。现在，每个人都可以在一定程度上看到项目中的其他人正在做些什么。而管理员也可以轻松掌控每个开发者的权限，并且管理一个 CVCS 要远比在各个客户端上维护本地数据库来得轻松容易。

事分两面，有好有坏。这么做最显而易见的缺点是中央服务器的单点故障。如果宕机一小时，那么在这一小时内，谁都无法提交更新，也就无法协同工作。要是中央服务器的磁盘发生故障，碰巧没做备份，或者备份不够及时，就会有丢失数据的风险。最坏的情况是彻底丢失整个项目的所有历史更改记录，而被客户端偶然提取出来的保存在本地的某些快照数据就成了恢复数据的希望。但这样的话依然是个问题，你不能保证所有的数据都已经有人事先完整提取出来过。本地版本控制系统也存在类似问题，只要整个项目的历史记录被保存在单一位置，就有丢失所有历史更新记录的风险。

#### 分布式版本控制系统

于是分布式版本控制系统（ Distributed Version Control System，简称 DVCS ）面世了。在这类系统中，像 Git，Mercurial，Bazaar 以及 Darcs 等，客户端并不只提取最新版本的文件快照，而是把代码仓库完整地镜像下来。这么一来，任何一处协同工作用的服务器发生故障，事后都可以用任何一个镜像出来的本地仓库恢复。因为每一次的提取操作，实际上都是一次对代码仓库的完整备份。

更进一步，许多这类系统都可以指定和若干不同的远端代码仓库进行交互。籍此，你就可以在同一个项目中，分别和不同工作小组的人相互协作。你可以根据需要设定不同的协作流程，比如层次模型式的工作流，而这在以前的集中式系统中是无法实现的。

![](https://ws1.sinaimg.cn/large/006KyevZly1g16sc44tjxj30dw0fn3yr.jpg)

参考：[版本控制——总结](https://www.cnblogs.com/yanghongliang/p/5750306.html)

​	[《Pro Git》](http://iissnan.com/progit/)

