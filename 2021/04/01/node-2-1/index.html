<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Node.JS web开发前置知识 | 平心de小屋</title><meta name="keywords" content="Node.JS,后端"><meta name="author" content="平心"><meta name="copyright" content="平心"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="web开发前置知识  http 编码 加密">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.JS web开发前置知识">
<meta property="og:url" content="https://pingxin0521.gitee.io/2021/04/01/node-2-1/index.html">
<meta property="og:site_name" content="平心de小屋">
<meta property="og:description" content="web开发前置知识  http 编码 加密">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg">
<meta property="article:published_time" content="2021-04-01T03:18:59.000Z">
<meta property="article:modified_time" content="2021-05-09T07:22:28.920Z">
<meta property="article:author" content="平心">
<meta property="article:tag" content="Node.JS">
<meta property="article:tag" content="后端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg"><link rel="shortcut icon" href="https://s2.ax1x.com/2020/02/11/1ovFOA.png"><link rel="canonical" href="https://pingxin0521.gitee.io/2021/04/01/node-2-1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Node.JS web开发前置知识',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-05-09 15:22:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://s2.ax1x.com/2020/02/11/1ovw6J.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">449</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">77</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">68</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">平心de小屋</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Node.JS web开发前置知识</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-01T03:18:59.000Z" title="发表于 2021-04-01 11:18:59">2021-04-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-09T07:22:28.920Z" title="更新于 2021-05-09 15:22:28">2021-05-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/Node-JS/">Node.JS</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Node.JS web开发前置知识"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>web开发前置知识</p>
<ol>
<li>http</li>
<li>编码</li>
<li>加密</li>
</ol>
<span id="more"></span>

<h3 id="base64编码"><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(Buffer.from(<span class="string">&#x27;Hello&#x27;</span>).toString(<span class="string">&#x27;base64&#x27;</span>))  <span class="comment">// SGVsbG8=</span></span><br><span class="line"><span class="built_in">console</span>.log(Buffer.from(<span class="string">&#x27;SGVsbG8=&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>).toString(<span class="string">&#x27;ascii&#x27;</span>))  <span class="comment">// hello</span></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<ol>
<li>用 <code>string</code> 新建一个 <code>Buffer</code></li>
<li>将 <code>Buffer</code> 解码成指定字符编码的 <code>string</code></li>
</ol>
<p>主要用到了 Buffer.from 的API，文档如下：</p>
<blockquote>
<p>Buffer.from(string[, encoding])</p>
<ol>
<li>string <string/> 要编码的字符串</li>
<li>encoding <string/> string 的字符编码。 默认: ‘utf8’</li>
</ol>
<p>buf.toString([encoding[, start[, end]]])</p>
<ul>
<li>encoding <string/> 解码使用的字符编码。默认: ‘utf8’</li>
<li>start <integer/> 开始解码的字节偏移量。默认: 0</li>
<li>end <integer/> 结束解码的字节偏移量（不包含）。 默认: buf.length</li>
<li>返回: <string/></li>
</ul>
</blockquote>
<p>在<code>NodeJS</code>中，<code>Buffer</code>是一个全局对象，所以使用时无需单独 <code>require</code>。在创建 <code>Buffer</code> 时，我们可以通过第二个参数，指明 <code>string</code>的编码类型（例如，<code>base64</code>）。</p>
<p><code>buf.toString</code>时，也可以指定编码类型。默认为<code>utf8</code>。主要编码类型有 <code>ascii</code>、<code>utf8</code>、<code>ucs2</code>、<code>base64</code>、<code>binary</code>。</p>
<h3 id="md5和Hmac加密"><a href="#md5和Hmac加密" class="headerlink" title="md5和Hmac加密"></a>md5和Hmac加密</h3><p>在nodejs中，可以使用crypto模块来实现各种不同的加密与解密处理，在crypto模块中包含了类似MD5或SHA-1这些散列算法，我们可以通过crypto模块来实现HMAC运算。</p>
<p>HMAC的中文意思是：散列运算消息认证码；运算使用散列算法，以一个密钥和一个消息为输入，生成一个消息摘要作为输出。HMAC运算可以用来验证两段数据是否匹配，以确认该数据没有被篡改。</p>
<p>在crypto模块中，为每一种加密算法定义了一个类。可以使用getCiphers方法来查看nodejs中能够使用的所有加密算法。该方法返回一个数组，包括了nodejS中能够使用的所有散列算法。使用方法如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(crypto.getCiphers());</span><br></pre></td></tr></table></figure>

<h4 id="散列算法"><a href="#散列算法" class="headerlink" title="散列算法"></a>散列算法</h4><p>散列(也可以叫哈希)算法，它是用来对一段数据进行验证前，将该数据模糊化，或者也可以为一大段数据提供一个校验码。<br>在nodejs中，为了使用该散列算法，我们先要使用 createHash方法创建一个hash对象。使用方法如下：</p>
<p><strong>crypto.createHash(params);</strong></p>
<p>在如上方法中，需要使用一个参数，其参数值为一个在Node.js中可以使用的算法，比如 ‘sha1’, ‘md5’, ‘sha512’ 等等这样的，用于指定需要使用的散列算法，该方法返回被创建的hash对象。</p>
<p>在创建完hash对象后，可以通过使用该对象的update方法创建一个摘要。该方法的使用方式如下：</p>
<p><strong>hash.update(data, [encoding]);</strong></p>
<p>在如上面的方法，该方法需要使用两个参数，第一个参数是必选项，该参数值是一个Buffer对象或一个字符串，用于指定摘要内容； 第二个参数 encoding用于指定摘要内容所需使用的编码格式，可以指定为 ‘utf-8’, ‘ascii’, 或 ‘binary’. 如果不使用第二个参数，则第一个参数data参数值必须为一个Buffer对象，我们也可以在摘要被输出前使用多次updata方法来添加摘要内容。</p>
<p>在第一步创建了一个hash对象后，第二步就是添加摘要内容，那么第三步我们就是使用hash对象的digest方法来输出摘要内容了；在使用hash对象的digest<br>方法后，不能再向hash对象中追加摘要内容，也就是说你使用了digest方法作为输出后，你再追加内容也不会执行，因此是不能向hash对象中追加内容。<br>使用方法如下：</p>
<p><strong>hash.digest([encoding]);</strong></p>
<p>该方法有一个参数，该参数是一个可选值，表示的意思是 用于指定输出摘要的编码格式，可指定参数值为 ‘hex’, ‘binary’, 及 ‘base64’.如果使用了该参数，那么digest方法返回字符串格式的摘要内容，如果不使用该参数，那么digest方法返回一个是Buffer对象。</p>
<h4 id="MD5算法"><a href="#MD5算法" class="headerlink" title="MD5算法"></a>MD5算法</h4><p>MD5是计算机领域使用最广泛的散列函数(可以叫哈希算法、摘要算法)，注意是用来确保消息的完整和一致性。</p>
<p>下面我们最主要是以 md5 加密为例来了解下加密算法。<br>MD5算法有以下特点：</p>
<ol>
<li>压缩性： 任意长度的数据，算出的MD5值长度都是固定的。</li>
<li> 容易计算：从原数据算出MD5值很容易。</li>
<li> 抗修改性：对原数据进行任何改动，哪怕只修改一个字节，所得到的MD5值都有很大的区别。</li>
<li>强抗碰撞：已知原数据和其MD5值，想找到一个具有相同的MD5值的伪数据是非常困难的。</li>
</ol>
<p>MD5的作用是让大容量信息在用数字签名软件签署私人秘钥前被压缩成一种保密的格式(就是把任意长度的字符串变换成一定长的十六进制数字串)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个hash对象</span></span><br><span class="line"><span class="keyword">const</span> md5 = crypto.createHash(<span class="string">&#x27;md5&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往hash对象中添加摘要内容</span></span><br><span class="line">md5.update(str);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 digest 方法输出摘要内容，不使用编码格式的参数 其输出的是一个Buffer对象</span></span><br><span class="line"><span class="comment">// console.log(md5.digest()); </span></span><br><span class="line"><span class="comment">// 输出 &lt;Buffer 90 01 50 98 3c d2 4f b0 d6 96 3f 7d 28 e1 7f 72&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用编码格式的参数，输出的是一个字符串格式的摘要内容</span></span><br><span class="line"><span class="built_in">console</span>.log(md5.digest(<span class="string">&#x27;hex&#x27;</span>)); <span class="comment">// 输出 900150983cd24fb0d6963f7d28e17f72</span></span><br></pre></td></tr></table></figure>

<p>只对md5加密的缺点：</p>
<p>通过上面对md5加密后确实比明文好很多，至少很多人直接使用肉眼看到的并记不住，也不知道密码多少，但是只对md5加密也存在缺点，如上代码使用console.log打印两次后，加密后的代码是一样，也就是说 相同的明文密码，加密后，输出两次，md5的值也是一样的。 所以这样也是不安全的。</p>
<p><strong>密码加盐：</strong></p>
<p>什么意思呢？就是在密码的特定位置上插入特定的字符串后，再对修改后的字符串进行md5加密，这样做的好处是每次调用代码的时候，插入的字符串不一样，会导致最后的md5值会不一样的。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> saltPasswordFunc = <span class="function"><span class="keyword">function</span>(<span class="params">password, salt</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 密码加盐</span></span><br><span class="line">  <span class="keyword">const</span> saltPassword = password + <span class="string">&#x27;:&#x27;</span> + salt;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;原始密码：%s&#x27;</span>, password); </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;加盐后的密码：%s&#x27;</span>, saltPassword);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> md5 = crypto.createHash(<span class="string">&#x27;md5&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> result = md5.update(saltPassword).digest(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;加盐密码后的md5的值为：%s&#x27;</span>, result);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> password = <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line">saltPasswordFunc(password, <span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 输出结果为：</span></span><br><span class="line"><span class="comment"> 原始密码：123456</span></span><br><span class="line"><span class="comment"> 加盐后的密码：123456:abc</span></span><br><span class="line"><span class="comment"> 加盐密码后的md5的值为：51011af1892f59e74baf61f3d4389092</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">saltPasswordFunc(password, <span class="string">&#x27;def&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 输出结果为：</span></span><br><span class="line"><span class="comment"> 原始密码：123456</span></span><br><span class="line"><span class="comment"> 加盐后的密码：123456:def</span></span><br><span class="line"><span class="comment"> 加盐密码后的md5的值为：5091d17d6b08ba9a95ccef51f598b249</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="HMAC算法"><a href="#HMAC算法" class="headerlink" title="HMAC算法"></a>HMAC算法</h4><p>HMAC算法是将散列算法与一个密钥结合在一起，以阻止对签名完整性破坏，其实就是类似于上面的提到的md5密码中加盐道理是类似的。<br>使用HMAC算法前，我们使用createHmac方法创建一个hmac对象，创建方法如下所示：</p>
<p><strong>crypto.createHmac(params, key);</strong></p>
<p>该方法中使用两个参数，第一个参数含义是在Node.js中使用的算法，比如’sha1’, ‘md5’, ‘sha256’, ‘sha512’等等，该方法返回的是hmac对象。<br>key参数值为一个字符串，用于指定一个PEM格式的密钥。</p>
<p>在创建完成hmac对象后，我们也是一样使用一个update方法来创建一个摘要，该方法使用如下所示：</p>
<p><strong>hmac.update(data);</strong></p>
<p>在update方法中，使用一个参数，其参数值为一个Buffer对象或一个字符串，用于指定摘要内容。也是一样可以在被输出之前使用多次update方法来添加摘要内容。</p>
<p>最后一步就是 使用hmac对象的digest方法来输出摘要内容了；在使用hmac对象的digest方法后，不能再向hmac对象中追加摘要内容，也就是说你使用了digest方法作为输出后，因此是不能向hmac对象中追加内容。使用方法如下：</p>
<p><strong>hmac.digest([encoding]);</strong></p>
<p>该方法有一个参数，该参数是一个可选值，表示的意思是 用于指定输出摘要的编码格式，可指定参数值为 ‘hex’, ‘binary’, 及 ‘base64’.<br>如果使用了该参数，那么digest方法返回字符串格式的摘要内容，如果不使用该参数，那么digest方法返回一个是Buffer对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个hmac对象</span></span><br><span class="line"><span class="keyword">const</span> hmac = crypto.createHmac(<span class="string">&#x27;md5&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往hmac对象中添加摘要内容</span></span><br><span class="line"><span class="keyword">const</span> up = hmac.update(<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 digest 方法输出摘要内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = up.digest(<span class="string">&#x27;hex&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// 8c7498982f41b93eb0ce8216b48ba21d</span></span><br></pre></td></tr></table></figure>

<h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><p>我们都知道 Node.js 是以单线程的模式运行的，但它使用的是事件驱动来处理并发，这样有助于我们在多核 cpu 的系统上创建多个子进程，从而提高性能。</p>
<p>每个子进程总是带有三个流对象：child.stdin, child.stdout 和child.stderr。他们可能会共享父进程的 stdio 流，或者也可以是独立的被导流的流对象。</p>
<p>Node 提供了 child_process 模块来创建子进程，方法有：</p>
<ul>
<li><strong>exec</strong> - child_process.exec 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数参数的形式返回。</li>
<li><strong>spawn</strong> - child_process.spawn 使用指定的命令行参数创建新进程。</li>
<li><strong>fork</strong> - child_process.fork 是 spawn()的特殊形式，用于在子进程中运行的模块，如 fork(‘./son.js’) 相当于 spawn(‘node’, [‘./son.js’]) 。与spawn方法不同的是，fork会在父进程与子进程之间，建立一个通信管道，用于进程之间的通信。</li>
</ul>
<h5 id="exec-方法"><a href="#exec-方法" class="headerlink" title="exec() 方法"></a>exec() 方法</h5><p>child_process.exec 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数参数的形式返回。</p>
<p>语法如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">child_process.exec(command[, options], callback)</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<p>参数说明如下：</p>
<p><strong>command：</strong> 字符串， 将要运行的命令，参数使用空格隔开</p>
<p><strong>options ：对象，可以是：</strong></p>
<ul>
<li>cwd ，字符串，子进程的当前工作目录</li>
<li>env，对象 环境变量键值对</li>
<li>encoding ，字符串，字符编码（默认： ‘utf8’）</li>
<li>shell ，字符串，将要执行命令的 Shell（默认: 在 UNIX 中为<code>/bin/sh</code>， 在 Windows 中为<code>cmd.exe</code>， Shell 应当能识别 <code>-c</code>开关在 UNIX 中，或 <code>/s /c</code> 在 Windows 中。 在Windows 中，命令行解析应当能兼容<code>cmd.exe</code>）</li>
<li>timeout，数字，超时时间（默认： 0）</li>
<li>maxBuffer，数字， 在 stdout 或 stderr 中允许存在的最大缓冲（二进制），如果超出那么子进程将会被杀死 （默认: 200*1024）</li>
<li>killSignal ，字符串，结束信号（默认：’SIGTERM’）</li>
<li>uid，数字，设置用户进程的 ID</li>
<li>gid，数字，设置进程组的 ID</li>
</ul>
<p><strong>callback ：</strong>回调函数，包含三个参数error, stdout 和 stderr。</p>
<p>exec() 方法返回最大的缓冲区，并等待进程结束，一次性返回缓冲区的内容。</p>
<p>让我们创建两个 js 文件 support.js 和 master.js。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//support.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;进程 &quot;</span> + process.argv[<span class="number">2</span>] + <span class="string">&quot; 执行。&quot;</span> );</span><br><span class="line"><span class="comment">//master.js 文件代码：</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> workerProcess = child_process.exec(<span class="string">&#x27;node support.js &#x27;</span>+i, <span class="function"><span class="keyword">function</span> (<span class="params">error, stdout, stderr</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error.stack);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;Error code: &#x27;</span>+error.code);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;Signal received: &#x27;</span>+error.signal);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;stdout: &#x27;</span> + stdout);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;stderr: &#x27;</span> + stderr);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    workerProcess.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;子进程已退出，退出码 &#x27;</span>+code);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ node master.js </span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">stdout: 进程 1 执行。</span><br><span class="line"></span><br><span class="line">stderr: </span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">stdout: 进程 0 执行。</span><br><span class="line"></span><br><span class="line">stderr: </span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">stdout: 进程 2 执行。</span><br><span class="line"></span><br><span class="line">stderr: </span><br></pre></td></tr></table></figure>

<h5 id="spawn-方法"><a href="#spawn-方法" class="headerlink" title="spawn() 方法"></a>spawn() 方法</h5><p>child_process.spawn 使用指定的命令行参数创建新进程，语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">child_process.spawn(command[, args][, options])</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<p>参数说明如下：</p>
<p><strong>command：</strong> 将要运行的命令</p>
<p><strong>args：</strong> Array 字符串参数数组</p>
<p><strong>options Object</strong></p>
<ul>
<li>cwd String 子进程的当前工作目录</li>
<li>env Object 环境变量键值对</li>
<li>stdio Array|String 子进程的 stdio 配置</li>
<li>detached Boolean 这个子进程将会变成进程组的领导</li>
<li>uid Number 设置用户进程的 ID</li>
<li>gid Number 设置进程组的 ID</li>
</ul>
<p>spawn() 方法返回流 (stdout &amp; stderr)，在进程返回大量数据时使用。进程一旦开始执行时 spawn() 就开始接收响应。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//support.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;进程 &quot;</span> + process.argv[<span class="number">2</span>] + <span class="string">&quot; 执行。&quot;</span> );</span><br><span class="line"><span class="comment">//master.js 文件代码：</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">   <span class="keyword">var</span> workerProcess = child_process.spawn(<span class="string">&#x27;node&#x27;</span>, [<span class="string">&#x27;support.js&#x27;</span>, i]);</span><br><span class="line"> </span><br><span class="line">   workerProcess.stdout.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;stdout: &#x27;</span> + data);</span><br><span class="line">   &#125;);</span><br><span class="line"> </span><br><span class="line">   workerProcess.stderr.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;stderr: &#x27;</span> + data);</span><br><span class="line">   &#125;);</span><br><span class="line"> </span><br><span class="line">   workerProcess.on(<span class="string">&#x27;close&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;子进程已退出，退出码 &#x27;</span>+code);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ node master.js stdout: 进程 0 执行。</span><br><span class="line"></span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">stdout: 进程 1 执行。</span><br><span class="line"></span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">stdout: 进程 2 执行。</span><br><span class="line"></span><br><span class="line">子进程已退出，退出码 0</span><br></pre></td></tr></table></figure>

<h5 id="fork-方法"><a href="#fork-方法" class="headerlink" title="fork 方法"></a>fork 方法</h5><p>child_process.fork 是 spawn() 方法的特殊形式，用于创建进程，语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">child_process.fork(modulePath[, args][, options])</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<p>参数说明如下：</p>
<p><strong>modulePath</strong>： String，将要在子进程中运行的模块</p>
<p><strong>args</strong>： Array 字符串参数数组</p>
<p><strong>options</strong>：Object</p>
<ul>
<li>cwd String 子进程的当前工作目录</li>
<li>env Object 环境变量键值对</li>
<li>execPath String 创建子进程的可执行文件</li>
<li>execArgv Array 子进程的可执行文件的字符串参数数组（默认： process.execArgv）</li>
<li>silent Boolean 如果为<code>true</code>，子进程的<code>stdin</code>，<code>stdout</code>和<code>stderr</code>将会被关联至父进程，否则，它们将会从父进程中继承。（默认为：<code>false</code>）</li>
<li>uid Number 设置用户进程的 ID</li>
<li>gid Number 设置进程组的 ID</li>
</ul>
<p>返回的对象除了拥有ChildProcess实例的所有方法，还有一个内建的通信信道。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//support.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;进程 &quot;</span> + process.argv[<span class="number">2</span>] + <span class="string">&quot; 执行。&quot;</span> );</span><br><span class="line"><span class="comment">//master.js 文件代码：</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">   <span class="keyword">var</span> worker_process = child_process.fork(<span class="string">&quot;support.js&quot;</span>, [i]);    </span><br><span class="line"> </span><br><span class="line">   worker_process.on(<span class="string">&#x27;close&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;子进程已退出，退出码 &#x27;</span> + code);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ node master.js </span><br><span class="line">进程 0 执行。</span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">进程 1 执行。</span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">进程 2 执行。</span><br><span class="line">子进程已退出，退出码 0</span><br></pre></td></tr></table></figure>

<h4 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h4><p>使用了淘宝定制的 cnpm 命令进行安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm install mysql</span><br></pre></td></tr></table></figure>

<p>在以下实例中根据你的实际配置修改数据库用户名、及密码及数据库名：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 mysql 数据库连接依赖</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&quot;mysql&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 mysql 连接池并配置参数</span></span><br><span class="line"><span class="keyword">const</span> pool = mysql.createPool(&#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,    <span class="comment">// 主机地址</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">3306</span>,                 <span class="comment">// 端口</span></span><br><span class="line">    <span class="attr">user</span>: <span class="string">&quot;root&quot;</span>,               <span class="comment">// 数据库访问账号</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">&quot;920619&quot;</span>,         <span class="comment">// 数据库访问密码</span></span><br><span class="line">    <span class="attr">database</span>: <span class="string">&quot;test&quot;</span>,           <span class="comment">// 要访问的数据库</span></span><br><span class="line">    <span class="attr">charset</span>: <span class="string">&quot;UTF8_GENERAL_CI&quot;</span>, <span class="comment">// 字符编码 ( 必须大写 )</span></span><br><span class="line">    <span class="attr">typeCast</span>: <span class="literal">true</span>,             <span class="comment">// 是否把结果值转换为原生的 javascript 类型</span></span><br><span class="line">    <span class="attr">supportBigNumbers</span>: <span class="literal">true</span>,    <span class="comment">// 处理大数字 (bigint, decimal), 需要开启 ( 结合 bigNumberStrings 使用 )</span></span><br><span class="line">    <span class="attr">bigNumberStrings</span>: <span class="literal">true</span>,     <span class="comment">// 大数字 (bigint, decimal) 值转换为javascript字符对象串</span></span><br><span class="line">    <span class="attr">multipleStatements</span>: <span class="literal">false</span>,  <span class="comment">// 允许每个mysql语句有多条查询, 未防止sql注入不开启</span></span><br><span class="line">    <span class="comment">//connectTimeout: 5000,     // 数据库连接超时时间, 默认无超时</span></span><br><span class="line">&#125;);</span><br><span class="line">pool.connectionLimit = <span class="number">10</span>;      <span class="comment">// 连接池中可以存放的最大连接数量</span></span><br><span class="line">pool.waitForConnections = <span class="literal">true</span>; <span class="comment">// 连接使用量超负荷是否等待, false 会报错</span></span><br><span class="line">pool.queueLimit = <span class="number">0</span>;            <span class="comment">// 每个连接可操作的 列数 上限, 0 为没有上限</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对外暴漏从连接池中获取数据库连接的方法</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        pool.getConnection(<span class="function">(<span class="params">err, conn</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;数据库连接获取失败&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resolve(conn);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>连接参数</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">host</td>
<td align="left">主机地址 （默认：localhost）</td>
</tr>
<tr>
<td align="left">user</td>
<td align="left">用户名</td>
</tr>
<tr>
<td align="left">password</td>
<td align="left">密码</td>
</tr>
<tr>
<td align="left">port</td>
<td align="left">端口号 （默认：3306）</td>
</tr>
<tr>
<td align="left">database</td>
<td align="left">数据库名</td>
</tr>
<tr>
<td align="left">charset</td>
<td align="left">连接字符集（默认：’UTF8_GENERAL_CI’，注意字符集的字母都要大写）</td>
</tr>
<tr>
<td align="left">localAddress</td>
<td align="left">此IP用于TCP连接（可选）</td>
</tr>
<tr>
<td align="left">socketPath</td>
<td align="left">连接到unix域路径，当使用 host 和 port 时会被忽略</td>
</tr>
<tr>
<td align="left">timezone</td>
<td align="left">时区（默认：’local’）</td>
</tr>
<tr>
<td align="left">connectTimeout</td>
<td align="left">连接超时（默认：不限制；单位：毫秒）</td>
</tr>
<tr>
<td align="left">stringifyObjects</td>
<td align="left">是否序列化对象</td>
</tr>
<tr>
<td align="left">typeCast</td>
<td align="left">是否将列值转化为本地JavaScript类型值 （默认：true）</td>
</tr>
<tr>
<td align="left">queryFormat</td>
<td align="left">自定义query语句格式化方法</td>
</tr>
<tr>
<td align="left">supportBigNumbers</td>
<td align="left">数据库支持bigint或decimal类型列时，需要设此option为true （默认：false）</td>
</tr>
<tr>
<td align="left">bigNumberStrings</td>
<td align="left">supportBigNumbers和bigNumberStrings启用 强制bigint或decimal列以JavaScript字符串类型返回（默认：false）</td>
</tr>
<tr>
<td align="left">dateStrings</td>
<td align="left">强制timestamp,datetime,data类型以字符串类型返回，而不是JavaScript Date类型（默认：false）</td>
</tr>
<tr>
<td align="left">debug</td>
<td align="left">开启调试（默认：false）</td>
</tr>
<tr>
<td align="left">multipleStatements</td>
<td align="left">是否许一个query中有多个MySQL语句 （默认：false）</td>
</tr>
<tr>
<td align="left">flags</td>
<td align="left">用于修改连接标志</td>
</tr>
<tr>
<td align="left">ssl</td>
<td align="left">使用ssl参数（与crypto.createCredenitals参数格式一至）或一个包含ssl配置文件名称的字符串，目前只捆绑Amazon RDS的配置文件</td>
</tr>
</tbody></table>
<p>更多说明可参见：<a target="_blank" rel="noopener" href="https://github.com/mysqljs/mysql">https://github.com/mysqljs/mysql</a></p>
<p>执行简单的操作测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入工具类</span></span><br><span class="line"><span class="keyword">let</span> mysqlUtil = <span class="built_in">require</span>(<span class="string">&quot;./mysql-util&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个同步方法, 这里要求有 SQL 语句的基础</span></span><br><span class="line"><span class="keyword">let</span> ceshi = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取连接, es6 新特性 awit 不能少</span></span><br><span class="line">    <span class="keyword">let</span> conn = <span class="keyword">await</span> mysqlUtil();</span><br><span class="line">    <span class="comment">// 准备一个防 SQL 注入的 SQL 语句, 并准备参数</span></span><br><span class="line">    <span class="keyword">let</span> sqlStr = <span class="string">&quot;INSERT INTO user (UserName, UserSex) value (?, ?)&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> sqlParam = [<span class="string">&quot;姓名&quot;</span>, <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 执行 SQL 语句并返回结果</span></span><br><span class="line">    conn.query(sqlStr, sqlParam, <span class="function"><span class="keyword">function</span> (<span class="params">err, ret</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(ret);</span><br><span class="line">　　　　　conn.release();　</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用方法</span></span><br><span class="line">ceshi();</span><br></pre></td></tr></table></figure>

<p>执行带事务的操作测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入工具类</span></span><br><span class="line"><span class="keyword">let</span> mysqlUtil = <span class="built_in">require</span>(<span class="string">&quot;./mysql-util&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个同步方法, 这里要求有 SQL 语句的基础</span></span><br><span class="line"><span class="comment">// 在 beginTransaction 和 commit 之间可以执行多次 query 方法</span></span><br><span class="line"><span class="keyword">let</span> ceshi = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取连接</span></span><br><span class="line">    <span class="keyword">let</span> conn = <span class="keyword">await</span> mysqlUtil();</span><br><span class="line">    <span class="comment">// 开启事物</span></span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        conn.beginTransaction(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                reject(err);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resolve();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 执行第一个 SQL 语句</span></span><br><span class="line">    <span class="keyword">let</span> result1 = <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> sqlStr = <span class="string">&quot;INSERT INTO user (UserName, UserSex) values (?, ?)&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> sqlParam = [<span class="string">&quot;姓名2&quot;</span>, <span class="number">0</span>];</span><br><span class="line">        conn.query(sqlStr, sqlParam, <span class="function"><span class="keyword">function</span> (<span class="params">err, ret</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="comment">// 回滚之前的数据库操作, 直至碰到 beginTransaction</span></span><br><span class="line">                <span class="keyword">return</span> conn.rollback(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    resolve(err);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            resolve(ret);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(result1);</span><br><span class="line">    <span class="comment">// 执行第二个 SQL 语句</span></span><br><span class="line">    <span class="keyword">let</span> result2 = <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> sqlStr = <span class="string">&quot;SELECT * FROM user&quot;</span>;</span><br><span class="line">        <span class="comment">//let sqlStr = &quot;SELEC * FROM user&quot;; // 错误的 SQL 语句</span></span><br><span class="line">        conn.query(sqlStr, <span class="function"><span class="keyword">function</span> (<span class="params">err, ret</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="comment">// 回滚之前的数据库操作, 直至碰到 beginTransaction</span></span><br><span class="line">                <span class="keyword">return</span> conn.rollback(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    resolve(err);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            resolve(ret);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(result2);</span><br><span class="line">    <span class="comment">// 关闭事务</span></span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        conn.commit(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                reject(err);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resolve();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">　　 conn.release();　　</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用测试方法</span></span><br><span class="line">ceshi();</span><br></pre></td></tr></table></figure>

<h4 id="连接-MongoDB"><a href="#连接-MongoDB" class="headerlink" title="连接 MongoDB"></a>连接 MongoDB</h4><p>使用了<a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-npm.html#taobaonpm">淘宝定制的 cnpm 命令</a>进行安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm install mongodb -g</span><br></pre></td></tr></table></figure>

<p>操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">var</span> mongoose=<span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/users&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到数据库连接句柄</span></span><br><span class="line"><span class="keyword">var</span> db=mongoose.connection;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过 数据库连接句柄，监听mongoose数据库成功的事件</span></span><br><span class="line">db.on(<span class="string">&#x27;open&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接失败&#x27;</span>);</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义表数据结构</span></span><br><span class="line">    <span class="keyword">var</span> userModel=<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">        <span class="attr">id</span>:<span class="built_in">Number</span>,</span><br><span class="line">        <span class="attr">nickname</span>:<span class="built_in">String</span>,</span><br><span class="line">        <span class="attr">mobile</span>:<span class="built_in">String</span>,</span><br><span class="line">        <span class="attr">password</span>:<span class="built_in">String</span></span><br><span class="line">    </span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        <span class="attr">versionKey</span>:<span class="literal">false</span> <span class="comment">//去除： - -v</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将表的数据结构和表关联起来</span></span><br><span class="line">    <span class="comment">// var productModel=mongoose.model(&#x27;anyname&#x27;,表的数据结构，表名)</span></span><br><span class="line">    <span class="keyword">var</span> userModel=mongoose.model(<span class="string">&quot;userList&quot;</span>,userModel,<span class="string">&quot;userList&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    userList=[</span><br><span class="line">        &#123;<span class="attr">id</span>:<span class="number">0</span>,<span class="attr">nickname</span>:<span class="string">&quot;pwl&quot;</span>,<span class="attr">mobile</span>:<span class="string">&quot;15556930270&quot;</span>,<span class="attr">password</span>:<span class="string">&quot;123456&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">nickname</span>:<span class="string">&quot;ws&quot;</span>,<span class="attr">mobile</span>:<span class="string">&quot;15556931933&quot;</span>,<span class="attr">password</span>:<span class="string">&quot;123456&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">nickname</span>:<span class="string">&quot;yl&quot;</span>,<span class="attr">mobile</span>:<span class="string">&quot;15556930268&quot;</span>,<span class="attr">password</span>:<span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加数据（添加完数据可以在隐藏起来）</span></span><br><span class="line">     userModel.insertMany(userList,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;数据添加失败&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;数据添加成功:&quot;</span>,result);</span><br><span class="line">     &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除数据</span></span><br><span class="line">     userModel.remove(&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;删除数据失败&#x27;</span>);</span><br><span class="line">          <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;删除数据成功&quot;</span>);</span><br><span class="line">     &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//导出数据</span></span><br><span class="line">    <span class="built_in">module</span>.exports=&#123;</span><br><span class="line">        <span class="attr">userModel</span>:userModel</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">平心</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://pingxin0521.gitee.io/2021/04/01/node-2-1/">https://pingxin0521.gitee.io/2021/04/01/node-2-1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://pingxin0521.gitee.io" target="_blank">平心de小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Node-JS/">Node.JS</a><a class="post-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF/">后端</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/04/30/node-2-3/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/HjVAdIuT7bZJypS.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Koa -- 基于Node.js平台的下一代Web开发框架</div></div></a></div><div class="next-post pull-right"><a href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-1/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">第十一周--谷歌浏览器插件</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2019/06/07/node-1-0/" title="Node.JS 入门"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/okfOw28KlZFbE7z.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-04-01</div><div class="title">Node.JS 入门</div></div></a></div><div><a href="/2019/07/01/node-2-2/" title="Node.JS 再深入 -- http"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/7dHvepmfYOLWTrX.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-05-09</div><div class="title">Node.JS 再深入 -- http</div></div></a></div><div><a href="/2019/06/07/node-1-1/" title="Node.JS 入门"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/HjVAdIuT7bZJypS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-04-01</div><div class="title">Node.JS 入门</div></div></a></div><div><a href="/2019/06/30/node-1-2/" title="Node.JS 深入"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/7dHvepmfYOLWTrX.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-05-09</div><div class="title">Node.JS 深入</div></div></a></div><div><a href="/2021/04/30/node-2-3/" title="Koa -- 基于Node.js平台的下一代Web开发框架"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/HjVAdIuT7bZJypS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-05-10</div><div class="title">Koa -- 基于Node.js平台的下一代Web开发框架</div></div></a></div><div><a href="/2021/05/15/node-2-4/" title="Egg.js -- 为企业级框架和应用而生"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/okfOw28KlZFbE7z.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-05-16</div><div class="title">Egg.js -- 为企业级框架和应用而生</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://s2.ax1x.com/2020/02/11/1ovw6J.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">平心</div><div class="author-info__description">年轻人的life、learn and think</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">449</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">77</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">68</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hanyunpeng0521"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hanyunpeng0521" target="_blank" title="Github"><i class="fa fa-github"></i></a><a class="social-icon" href="mailto:m13839441583@163.com" target="_blank" title="Email"><i class="fa fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title=""><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">为什么呢？开始提问吧</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#base64%E7%BC%96%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">base64编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#md5%E5%92%8CHmac%E5%8A%A0%E5%AF%86"><span class="toc-number">2.</span> <span class="toc-text">md5和Hmac加密</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%A3%E5%88%97%E7%AE%97%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">散列算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MD5%E7%AE%97%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">MD5算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HMAC%E7%AE%97%E6%B3%95"><span class="toc-number">2.3.</span> <span class="toc-text">HMAC算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">多进程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#exec-%E6%96%B9%E6%B3%95"><span class="toc-number">3.0.1.</span> <span class="toc-text">exec() 方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#spawn-%E6%96%B9%E6%B3%95"><span class="toc-number">3.0.2.</span> <span class="toc-text">spawn() 方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#fork-%E6%96%B9%E6%B3%95"><span class="toc-number">3.0.3.</span> <span class="toc-text">fork 方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.1.</span> <span class="toc-text">连接数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-MongoDB"><span class="toc-number">3.2.</span> <span class="toc-text">连接 MongoDB</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/05/15/node-2-4/" title="Egg.js -- 为企业级框架和应用而生"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/okfOw28KlZFbE7z.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Egg.js -- 为企业级框架和应用而生"/></a><div class="content"><a class="title" href="/2021/05/15/node-2-4/" title="Egg.js -- 为企业级框架和应用而生">Egg.js -- 为企业级框架和应用而生</a><time datetime="2021-05-15T10:18:59.000Z" title="发表于 2021-05-15 18:18:59">2021-05-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/30/node-2-3/" title="Koa -- 基于Node.js平台的下一代Web开发框架"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/HjVAdIuT7bZJypS.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Koa -- 基于Node.js平台的下一代Web开发框架"/></a><div class="content"><a class="title" href="/2021/04/30/node-2-3/" title="Koa -- 基于Node.js平台的下一代Web开发框架">Koa -- 基于Node.js平台的下一代Web开发框架</a><time datetime="2021-04-30T10:18:59.000Z" title="发表于 2021-04-30 18:18:59">2021-04-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/01/node-2-1/" title="Node.JS web开发前置知识"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Node.JS web开发前置知识"/></a><div class="content"><a class="title" href="/2021/04/01/node-2-1/" title="Node.JS web开发前置知识">Node.JS web开发前置知识</a><time datetime="2021-04-01T03:18:59.000Z" title="发表于 2021-04-01 11:18:59">2021-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-1/" title="第十一周--谷歌浏览器插件"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/gGE57HRvpcKPfDY.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第十一周--谷歌浏览器插件"/></a><div class="content"><a class="title" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-1/" title="第十一周--谷歌浏览器插件">第十一周--谷歌浏览器插件</a><time datetime="2020-12-26T10:18:59.000Z" title="发表于 2020-12-26 18:18:59">2020-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-0/" title="第十一周--浏览器技术"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2020/05/08/vCnKyoFJZ1g4XYR.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第十一周--浏览器技术"/></a><div class="content"><a class="title" href="/2020/12/26/%E5%91%A8%E8%AE%B0-10-0/" title="第十一周--浏览器技术">第十一周--浏览器技术</a><time datetime="2020-12-26T06:18:59.000Z" title="发表于 2020-12-26 14:18:59">2020-12-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 平心</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '4lfIXzqxaC1ONs0MJO4oHu07-gzGzoHsz',
      appKey: 'qw99Bw8FD0KVKU9m457CwWsr',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>